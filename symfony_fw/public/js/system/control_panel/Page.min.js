"use strict";class ControlPanelPage{get getProfileFocus(){return this.profileFocus}set setProfileFocus(e){this.profileFocus=e}constructor(){this.selectSended=!1,this.selectId=-1,this.profileFocus=!1}action=()=>{this._selectDesktop(),this._selectMobile(),this._rankInMenu(),wysiwyg.create("#form_page_argument",$("#form_cp_page_create").find("input[type='submit']")),this._fieldsVisibility(),helper.wordTag("#page_roleUserId","#form_page_roleUserId"),$("#cp_page_saveDraft").on("click","",e=>{this._saveDraft("create")}),$("#form_cp_page_create").on("submit","",e=>{e.preventDefault(),ajax.send(!0,$(e.target).prop("action"),$(e.target).prop("method"),$(e.target).serialize(),"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,t=>{ajax.reply(t,`#${e.target.id}`),void 0!==t.response.values&&void 0!==t.response.values.id&&($("#cp_page_select_result").html(""),$("#cp_page_select_result_desktop").find(".refresh").click())},null,null)})};changeView=()=>{if(this.profileFocus=!1,"mobile"===helper.checkWidthType()){if(!0===this.selectSended&&(this.selectId=$("#form_cp_page_select_mobile").find("select option:selected").val(),this.selectSended=!1),this.selectId>=0){$("#cp_page_select_result_desktop").find(".checkbox_column input[type='checkbox']").prop("checked",!1);let e=$("#cp_page_select_result_desktop").find(".checkbox_column input[type='checkbox']").parents("tr").find(".id_column");$.each(e,(e,t)=>{$.trim($(t).text())===String(this.selectId)&&$(t).parents("tr").find(".checkbox_column input").prop("checked",!0)})}}else!0===this.selectSended&&(this.selectId=$.trim($("#cp_page_select_result_desktop").find(".checkbox_column input[type='checkbox']:checked").parents("tr").find(".id_column").text()),this.selectSended=!1),this.selectId>0&&$("#form_cp_page_select_mobile").find("select option[value='"+this.selectId+"']").prop("selected",!0);this._rankInMenu()};_selectDesktop=()=>{const e=new TableAndPagination;e.setButtonsStatus="show",e.create(window.url.cpPageSelect,"#cp_page_select_result_desktop",!0),e.search(),e.pagination(),e.sort(),$(document).on("click","#cp_page_select_result_desktop .refresh",t=>{ajax.send(!0,window.url.cpPageSelect,"post",{event:"refresh",token:window.session.token},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,t=>{ajax.reply(t,""),e.populate(t)},null,null)}),$(document).on("click","#cp_page_select_result_desktop .delete_all",e=>{popupEasy.create(window.text.index_5,window.textPage.label_2,()=>{ajax.send(!0,window.url.cpPageDelete,"post",{event:"deleteAll",token:window.session.token},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,e=>{ajax.reply(e,""),$.each($("#cp_page_select_result_desktop").find("table .id_column"),(e,t)=>{$.trim($(t).parents("tr").find(".id_column").text())>5&&$(t).parents("tr").remove()}),$("#cp_page_select_result").html("")},null,null)})}),$(document).on("click","#cp_page_select_result_desktop .cp_page_delete",e=>{let t=$.trim($(e.currentTarget).parents("tr").find(".id_column").text());this._deleteElement(t)}),$(document).on("click","#cp_page_select_button_desktop",e=>{let t=$.trim($(e.currentTarget).parent().find(".checkbox_column input:checked").parents("tr").find(".id_column").text());ajax.send(!0,window.url.cpPageProfile,"post",{event:"result",id:t,token:window.session.token},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",()=>{$("#cp_page_select_result").html("")},t=>{this._profile(t,`#${e.currentTarget.id}`)},null,null)}),$(document).on("click",".checkbox_column input[type='checkbox']",e=>{$("#cp_page_select_result").html("")})};_selectMobile=()=>{$(document).on("submit","#form_cp_page_select_mobile",e=>{e.preventDefault(),ajax.send(!0,$(e.currentTarget).prop("action"),$(e.currentTarget).prop("method"),helper.serializeJson($(e.currentTarget)),"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",()=>{$("#cp_page_select_result").html("")},t=>{this._profile(t,`#${e.currentTarget.id}`)},null,null)}),$(document).on("change","#form_page_select_id",e=>{$("#cp_page_select_result").html("")})};_profile=(e,t)=>{if(ajax.reply(e,t),!1===$.isEmptyObject(e.response)&&void 0!==e.response.render){this.selectSended=!0,$("#cp_page_select_result").html(e.response.render),this._rankInMenu(),language.page(),wysiwyg.create("#form_page_argument",$("#form_cp_page_profile").find("input[type='submit']")),this._fieldsVisibility(),this._selectFieldWithDisabledElement("#form_page_parent",e),helper.wordTag("#page_roleUserId","#form_page_roleUserId"),materialDesign.refresh(),$("#form_cp_page_profile").find(".form_row input, .form_row textarea").on("focus","",e=>{this.profileFocus=!0});let t=!1;$("#form_cp_page_profile").find(".wysiwyg").on("mouseover","",e=>{t=!0}),$("#form_cp_page_profile").find(".wysiwyg").on("mouseout","",e=>{t=!1}),$(window).on("blur","",e=>{!0===t&&(this.profileFocus=!0)}),$("#cp_page_saveDraft").on("click","",e=>{this._saveDraft("modify")}),$("#cp_page_publishDraft").on("click","",e=>{this._publishDraft()}),$("#form_cp_page_profile").on("submit","",e=>{wysiwyg.save(),e.preventDefault(),ajax.send(!0,$(e.target).prop("action"),$(e.target).prop("method"),$(e.target).serialize(),"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,t=>{ajax.reply(t,`#${e.target.id}`),void 0!==t.response.messages.success&&(this.profileFocus=!1,$("#form_page_event").val(""),$("#cp_page_select_result").html(""),$("#cp_page_select_result_desktop").find(".refresh").click())},null,null)}),$("#cp_page_delete").on("click","",e=>{this._deleteElement(null)})}};_rankInMenu=()=>{helper.sortableElement("#page_rankMenuSort","#form_page_rankMenuSort"),$("#form_page_parent").off("change").on("change","",e=>{ajax.send(!0,window.url.cpPageProfileSort,"post",{event:"refresh",id:$(e.target).val(),token:window.session.token},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,e=>{ajax.reply(e,""),void 0!==e.response.values.pageSortListHtml&&($("#page_rankMenuSort").find(".sort_result").html(e.response.values.pageSortListHtml),helper.sortableElement("#page_rankMenuSort","#form_page_rankMenuSort"))},null,null)})};_deleteElement=e=>{popupEasy.create(window.text.index_5,window.textPage.label_1,()=>{ajax.send(!0,window.url.cpPageDelete,"post",{event:"delete",id:e,token:window.session.token},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,t=>{ajax.reply(t,""),void 0!==t.response.values.text&&void 0!==t.response.values.button&&void 0!==t.response.values.pageSelectHtml?(popupEasy.create(window.text.index_5,t.response.values.text+t.response.values.button+t.response.values.pageSelectHtml),$("#cp_page_delete_parent_all").on("click","",t=>{ajax.send(!0,window.url.cpPageDelete,"post",{event:"parentAll",id:e,token:window.session.token},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,e=>{ajax.reply(e,""),this._deleteResponse(e)},null,null)}),$("#cp_page_delete_parent_new").on("change","",t=>{ajax.send(!0,window.url.cpPageDelete,"post",{event:"parentNew",id:e,parentNew:$(t.target).find("select").val(),token:window.session.token},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,e=>{ajax.reply(e,""),this._deleteResponse(e)},null,null)}),this._selectFieldWithDisabledElement("#cp_page_delete_parent_new",t)):this._deleteResponse(t)},null,null)})};_saveDraft=e=>{popupEasy.create(window.text.index_5,window.textPage.label_3,()=>{$("#form_page_event").val("save_draft_"+e),$("#form_cp_page_create").length>0?$("#form_cp_page_create").submit():$("#form_cp_page_profile").submit(),$("#form_page_event").val("")})};_publishDraft=()=>{popupEasy.create(window.text.index_5,window.textPage.label_4,()=>{$("#form_page_event").val("publish_draft"),$("#form_cp_page_profile").submit(),$("#form_page_event").val("")})};_selectFieldWithDisabledElement=(e,t)=>{let s=$(e).find("option"),l=!1,n=0;$.each(s,(s,o)=>{let r=parseInt(o.value),a=o.text.substr(0,o.text.indexOf("-|")+2),i=parseInt(t.response.values.pageId),p=parseInt(t.response.values.parentId);r===i||r===p?(l=!0,n=a.length):a.length<=n&&(l=!1),!0===l&&$(e).find("option").eq(s).prop("disabled",!0)})};_deleteResponse=e=>{void 0!==e.response.messages.success&&($.each($("#cp_page_select_result_desktop").find("table .id_column"),(t,s)=>{(void 0!==e.response.values.id&&e.response.values.id===$.trim($(s).text())||void 0!==e.response.values.removedId&&-1!==$.inArray($.trim($(s).text()),e.response.values.removedId))&&$(s).parents("tr").remove()}),$("#form_page_select_id").find("option[value='"+e.response.values.id+"']").remove(),$("#cp_page_select_result").html(""),$("#cp_page_select_result_desktop").find(".refresh").click())};_fieldsVisibility=()=>{this._fieldsVisibilityMenu(),this._fieldsVisibilityLink(),$("#form_page_showInMenu").on("change","",e=>{this._fieldsVisibilityMenu(),materialDesign.refresh()}),$("#form_page_onlyLink").on("change","",e=>{this._fieldsVisibilityLink(),materialDesign.refresh()})};_fieldsVisibilityMenu=()=>{"0"===$("#form_page_showInMenu").val()?($("#form_page_menuName").parents(".form_row ").hide(),$("#page_rankMenuSort").hide()):($("#form_page_menuName").parents(".form_row ").show(),$("#page_rankMenuSort").show())};_fieldsVisibilityLink=()=>{"0"===$("#form_page_onlyLink").val()?$("#form_page_link").parents(".form_row ").hide():$("#form_page_link").parents(".form_row ").show()}}