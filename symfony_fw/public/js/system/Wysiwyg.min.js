var wysiwyg=new Wysiwyg;function Wysiwyg(){var n,i,l,d,a,t,e=this;function c(e){if("load"===e)0<$(i).length&&($(i).html($(n).val()),$(".wysiwyg").find(".source").text($(n).val()),function(e){d.push(e),a=0}($(n).val()));else if("source"===e){if(0<$(i).length){var t=$.trim($(i).html());$(n).val(t),$(".wysiwyg").find(".source").text(t)}}else if("editor"===e){var l=$(".wysiwyg").find(".source");0<l.length&&$(i).html(l.text())}}function o(t,e){"undo"===t?s():"redo"===t?r():"foreColor"===t||"backColor"===t||"unlink"===t||"formatBlock"===t||"fontSize"===t?(l.execCommand(t,!1,e),u()):"createLink"===t?popupEasy.create(window.textWysiwyg.label_5,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_6+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$("#wysiwyg_popup").find(".mdc-text-field__input").val();l.execCommand(t,!1,e),u()}):"insertImage"===t?popupEasy.create(window.textWysiwyg.label_7,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_8+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$("#wysiwyg_popup").find(".mdc-text-field__input").val();l.execCommand(t,!1,e),u()}):"custom_button_add"===t?popupEasy.create(window.textWysiwyg.label_9,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),t=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val();f(""===t?'<button class="mdc-button mdc-button--dense mdc-button--raised" type="button" contenteditable="false" style="display: block;">'+e+"</button>":'<a class="mdc-button mdc-button--dense mdc-button--raised" href="'+t+'" type="button" contenteditable="false">'+e+"</a>"),u()}):"custom_table_add"===t?popupEasy.create(window.textWysiwyg.label_12,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input row_number" type="text" value="1" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_13+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input column_number" type="text" value="4" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_14+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){for(var e=$("#wysiwyg_popup").find(".row_number").val(),t=$("#wysiwyg_popup").find(".column_number").val(),l='<div class="mdc-layout-grid" contenteditable="false">',n=0;n<e;n++){l+='<div class="mdc-layout-grid__inner" contenteditable="false">';for(var i=0;i<t;i++)l+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';l+="</div>"}f(l+="</div>"),u()}):(l.execCommand(t,!1,null),u())}function s(){if(0<=a){var e=d[--a];a<0&&(e=d[a=0]),$(i).html(e),!0}}function r(){if(a<d.length-1){var e=d[++a];$(i).html(e),!0}}function u(){!function(){var e=$(l).find(".mdc-button, .mdc-layout-grid");$.each(e,function(e,t){0===$(t).prev("br").length&&$(t).before("<br>"),0===$(t).next("br").length&&$(t).after("<br>")})}(),function(){var e=$(l).find("br");$.each(e,function(e,t){1===$(t).prev("br").length&&$(t).prev("br").remove(),1===$(t).next("br").length&&$(t).next("br").remove()})}();var e=$(i).html();e!==d[a]&&(a<d.length-1&&d.splice(a+1),d.push(e),t<++a&&d.shift())}function p(){var e=window.frames[0].document,t=null;return e.getSelection?t=e.getSelection().anchorNode:e.selection&&(t=e.selection.anchorNode),null!==t&&(t=3===t.nodeType?t.parentNode:t),t}function f(e){var t=window.frames[0].document,l=null;if(t.getSelection){if(selection=t.getSelection(),selection.getRangeAt&&selection.rangeCount){var n=window.frames[0].document.createElement("div");n.innerHTML=e;for(var i=window.frames[0].document.createDocumentFragment(),d=null;node=n.firstChild;)d=i.appendChild(node);(l=selection.getRangeAt(0)).deleteContents(),l.insertNode(i),d&&((l=l.cloneRange()).setStartAfter(d),l.collapse(!0),selection.removeAllRanges(),selection.addRange(l))}}else t.selection&&(selection=t.selection,"Control"!==selection.type&&(l=selection.createRange()).pasteHTML(e))}e.init=function(){n="",l=i=null,d=new Array,a=-1,!(t=300)},e.create=function(e,t){setTimeout(function(){n=e,$(n).parent().css("margin","0"),$(n).parent().hide(),$(t).click(function(){c("source")}),0<$(".wysiwyg").length&&($(".wysiwyg").find(".editor").contents().find("head").append("<style>\n                    html {\n                        padding: 5px !important;\n                        height: auto !important;\n                    }\n                    body div {\n                        margin: 0;\n                        min-height: 19px;\n                    }\n                    body .mdc-layout-grid {\n                        padding: 0;\n                    }\n                    body .mdc-layout-grid .mdc-layout-grid__cell {\n                        border: 1px solid #000000;\n                    }\n                </style>"),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto+Mono_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto_300_400_500_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-icons_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-components-web_custom.min.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/system/"+window.setting.template+".css",type:"text/css"})),i=$(".wysiwyg").find(".editor").contents().find("body")[0],l=$(".wysiwyg").find(".editor").contents()[0],$(i).addClass("mdc-typography"),$(i).prop("contenteditable","true"),$(i).off("click").on("click","a",function(e){e.preventDefault()}),l.execCommand("defaultParagraphSeparator",!1,"div"),c("load"),$(".wysiwyg").find(".toolbar .mdc-fab").off("click").on("click","",function(e){e.preventDefault();var t=!0===$(e.target).parent().hasClass("mdc-fab")?$(e.target).parent():$(e.target),l=t.find("span").data("command");"source"===l?"none"===$(".wysiwyg").find(".source").css("display")==!0?(c("source"),$(".wysiwyg").find(".editor").hide(),$(".wysiwyg").find(".source").show()):(c("editor"),$(".wysiwyg").find(".source").hide(),$(".wysiwyg").find(".editor").show()):"foreColor"===l||"backColor"===l?o(l,t.next().val()):o(l)}),$(".wysiwyg").find(".mdc-select .mdc-select__native-control").off("change").on("change","",function(e){e.preventDefault();var t=$(e.target).data("command");"formatBlock"!==t&&"fontSize"!==t||o(t,$(e.target).val())}),$(i).on("click","",function(e){!1;var t=p();!1===$(t).hasClass("mdc-layout-grid__cell")&&0===$(t).parents(".mdc-layout-grid__cell").length&&$(i).find(".mdc-layout-grid__cell").prop("contenteditable",!1)}),$(i).on("dblclick","",function(e){!1;var t=p();0<$(t).parents(".mdc-layout-grid__cell").length&&(t=$(t).parents(".mdc-layout-grid__cell")[0]),!0===$(t).hasClass("mdc-layout-grid__cell")&&($(i).find(".mdc-layout-grid__cell").prop("contenteditable",!1),$(t).prop("contenteditable",!0),$(t).focus())}),$(i).on("keydown","",function(e){if(e.ctrlKey||!0===e.metaKey){if(e.shiftKey&&90===e.keyCode)return r(),!1;if(90===e.keyCode)return s(),!1}}),$(i).on("keyup","",function(e){u()}),$(i).contextmenu(function(e){var t="",l=null,n="";if(!0===$(e.target).hasClass("mdc-button")){if(t="button",l=$(e.target),!0===$(e.target).is("button"))n='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+(i=$(e.target).text())+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>';else if(!0===$(e.target).is("a")){var i=$(e.target).text(),d=void 0===$(e.target).prop("href")?"":$(e.target).prop("href");n='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+i+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="'+d+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>'}}else(!0===$(e.target).hasClass("mdc-layout-grid__cell")||0<$(e.target).parents(".mdc-layout-grid__cell").length)&&(l=$(e.target),0<$(e.target).parents(".mdc-layout-grid__cell").length&&(l=$(e.target).parents(".mdc-layout-grid__cell")),t="table",n="<fieldset>\n                    <legend>"+window.textWysiwyg.label_16+'</legend>\n                    <button id="row_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_17+'</button>\n                    <button id="row_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_18+"</button>\n                </fieldset>\n                <fieldset>\n                    <legend>"+window.textWysiwyg.label_19+'</legend>\n                    <button id="column_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_20+'</button>\n                    <button id="column_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_21+"</button>\n                </fieldset>");return""!==n&&function(l,n,e){popupEasy.create(window.textWysiwyg.label_15,'<div id="wysiwyg_popup">'+e+"</div>",function(){if("button"===l){var e=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),t=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val();n.text(e),n.prop("href",t)}u()}),"table"===l&&($("#row_add").off("click").on("click","",function(){for(var e=n.parent().find(".mdc-layout-grid__cell").length,t='<div class="mdc-layout-grid__inner" contenteditable="false">',l=0;l<e;l++)t+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';t+="</div>",n.parent().after(t),popupEasy.close(),u()}),$("#row_remove").off("click").on("click","",function(){n.parent().remove(),popupEasy.close(),u()}),$("#column_add").off("click").on("click","",function(){var l=n.index();$.each(n.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(e,t){$(t).find(".mdc-layout-grid__cell").eq(l).after('<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>')}),popupEasy.close(),u()}),$("#column_remove").off("click").on("click","",function(){var l=n.index();$.each(n.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(e,t){if(1===$(t).find(".mdc-layout-grid__cell").length)return n.parents(".mdc-layout-grid").remove(),!1;$(t).find(".mdc-layout-grid__cell").eq(l).remove()}),popupEasy.close(),u()}))}(t,l,n),!1}))},100)},e.historyClear=function(){d=new Array},e.save=function(){c("source")}}