"use strict";const wysiwyg=new Wysiwyg;function Wysiwyg(){let e,t,l,n,i,d,a;function c(l){if("load"===l)$(t).length>0&&($(t).html($(e).val()),$(".wysiwyg").find(".source").text($(e).val()),d=$(e).val(),n.push(d),i=0);else if("source"===l){if($(t).length>0){let l=$.trim($(t).html());$(e).val(l),$(".wysiwyg").find(".source").text(l)}}else if("editor"===l){let e=$(".wysiwyg").find(".source");e.length>0&&$(t).html(e.text())}var d}function o(e,t){"undo"===e?s():"redo"===e?r():"foreColor"===e||"backColor"===e||"unlink"===e||"formatBlock"===e||"fontSize"===e?(l.execCommand(e,!1,t),u()):"createLink"===e?popupEasy.create(window.textWysiwyg.label_5,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_6+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){let t=$("#wysiwyg_popup").find(".mdc-text-field__input").val();l.execCommand(e,!1,t),u()}):"insertImage"===e?popupEasy.create(window.textWysiwyg.label_7,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_8+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){let t=$("#wysiwyg_popup").find(".mdc-text-field__input").val();l.execCommand(e,!1,t),u()}):"custom_button_add"===e?popupEasy.create(window.textWysiwyg.label_9,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){let e=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),t=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val(),l="";f(l=""===t?'<button class="mdc-button mdc-button--dense mdc-button--raised" type="button" contenteditable="false" style="display: block;">'+e+"</button>":'<a class="mdc-button mdc-button--dense mdc-button--raised" href="'+t+'" type="button" contenteditable="false">'+e+"</a>"),u()}):"custom_table_add"===e?popupEasy.create(window.textWysiwyg.label_12,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input row_number" type="text" value="1" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_13+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input column_number" type="text" value="4" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_14+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){let e=$("#wysiwyg_popup").find(".row_number").val(),t=$("#wysiwyg_popup").find(".column_number").val(),l='<div class="mdc-layout-grid" contenteditable="false">';for(let n=0;n<e;n++){l+='<div class="mdc-layout-grid__inner" contenteditable="false">';for(let e=0;e<t;e++)l+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';l+="</div>"}f(l+="</div>"),u()}):(l.execCommand(e,!1,null),u())}function s(){if(i>=0){let e=n[--i];i<0&&(e=n[i=0]),$(t).html(e),a=!0}}function r(){if(i<n.length-1){let e=n[++i];$(t).html(e),a=!0}}function u(){!function(){let e=$(l).find(".mdc-button, .mdc-layout-grid");$.each(e,function(e,t){0===$(t).prev("br").length&&$(t).before("<br>"),0===$(t).next("br").length&&$(t).after("<br>")})}(),function(){let e=$(l).find("br");$.each(e,function(e,t){1===$(t).prev("br").length&&$(t).prev("br").remove(),1===$(t).next("br").length&&$(t).next("br").remove()})}();let e=$(t).html();e!==n[i]&&(i<n.length-1&&n.splice(i+1),n.push(e),++i>d&&n.shift())}function p(){let e=window.frames[0].document,t=null,l=null;return e.getSelection?l=(t=e.getSelection()).anchorNode:e.selection&&(l=(t=e.selection).anchorNode),null!==l&&(l=3===l.nodeType?l.parentNode:l),l}function f(e){let t=window.frames[0].document,l=null;if(t.getSelection){if(selection=t.getSelection(),selection.getRangeAt&&selection.rangeCount){let t=window.frames[0].document.createElement("div");t.innerHTML=e;let n=window.frames[0].document.createDocumentFragment(),i=null;for(;node=t.firstChild;)i=n.appendChild(node);(l=selection.getRangeAt(0)).deleteContents(),l.insertNode(n),i&&((l=l.cloneRange()).setStartAfter(i),l.collapse(!0),selection.removeAllRanges(),selection.addRange(l))}}else t.selection&&(selection=t.selection,"Control"!==selection.type&&(l=selection.createRange()).pasteHTML(e))}this.init=function(){e="",t=null,l=null,n=[],i=-1,d=300,a=!1},this.create=function(n,i){setTimeout(function(){e=n,$(e).parent().css("margin","0"),$(e).parent().hide(),$(i).click(function(){c("source")}),$(".wysiwyg").length>0&&($(".wysiwyg").find(".editor").contents().find("head").append("<style>\n                    html {\n                        padding: 5px !important;\n                        height: auto !important;\n                    }\n                    body div {\n                        margin: 0;\n                        min-height: 19px;\n                    }\n                    body .mdc-layout-grid {\n                        padding: 0;\n                    }\n                    body .mdc-layout-grid .mdc-layout-grid__cell {\n                        border: 1px solid #000000;\n                    }\n                </style>"),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto+Mono_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto_300_400_500_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-icons_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-components-web_custom.min.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/system/"+window.setting.template+".css",type:"text/css"})),t=$(".wysiwyg").find(".editor").contents().find("body")[0],l=$(".wysiwyg").find(".editor").contents()[0],$(t).addClass("mdc-typography"),$(t).prop("contenteditable","true"),$(t).off("click").on("click","a",function(e){e.preventDefault()}),l.execCommand("defaultParagraphSeparator",!1,"div"),c("load"),$(".wysiwyg").find(".toolbar .mdc-fab").off("click").on("click","",function(e){e.preventDefault();let t=!0===$(e.target).parent().hasClass("mdc-fab")?$(e.target).parent():$(e.target),l=t.find("span").data("command");"source"===l?"none"===$(".wysiwyg").find(".source").css("display")==1?(c("source"),$(".wysiwyg").find(".editor").hide(),$(".wysiwyg").find(".source").show()):(c("editor"),$(".wysiwyg").find(".source").hide(),$(".wysiwyg").find(".editor").show()):"foreColor"===l||"backColor"===l?o(l,t.next().val()):o(l)}),$(".wysiwyg").find(".mdc-select .mdc-select__native-control").off("change").on("change","",function(e){e.preventDefault();let t=$(e.target).data("command");"formatBlock"!==t&&"fontSize"!==t||o(t,$(e.target).val())}),$(t).on("click","",function(e){a=!1;let l=p();!1===$(l).hasClass("mdc-layout-grid__cell")&&0===$(l).parents(".mdc-layout-grid__cell").length&&$(t).find(".mdc-layout-grid__cell").prop("contenteditable",!1)}),$(t).on("dblclick","",function(e){a=!1;let l=p();$(l).parents(".mdc-layout-grid__cell").length>0&&(l=$(l).parents(".mdc-layout-grid__cell")[0]),!0===$(l).hasClass("mdc-layout-grid__cell")&&($(t).find(".mdc-layout-grid__cell").prop("contenteditable",!1),$(l).prop("contenteditable",!0),$(l).focus())}),$(t).on("keydown","",function(e){if(e.ctrlKey||!0===e.metaKey){if(e.shiftKey&&90===e.keyCode)return r(),!1;if(90===e.keyCode)return s(),!1}}),$(t).on("keyup","",function(e){u()}),$(t).contextmenu(function(e){let t="",l=null,n="";if(!0===$(e.target).hasClass("mdc-button")){if(t="button",l=$(e.target),!0===$(e.target).is("button")){let t=$(e.target).text();n='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+t+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>'}else if(!0===$(e.target).is("a")){let t=$(e.target).text(),l=void 0===$(e.target).prop("href")?"":$(e.target).prop("href");n='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+t+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="'+l+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>'}}else(!0===$(e.target).hasClass("mdc-layout-grid__cell")||$(e.target).parents(".mdc-layout-grid__cell").length>0)&&(l=$(e.target),$(e.target).parents(".mdc-layout-grid__cell").length>0&&(l=$(e.target).parents(".mdc-layout-grid__cell")),t="table",n="<fieldset>\n                    <legend>"+window.textWysiwyg.label_16+'</legend>\n                    <button id="row_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_17+'</button>\n                    <button id="row_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_18+"</button>\n                </fieldset>\n                <fieldset>\n                    <legend>"+window.textWysiwyg.label_19+'</legend>\n                    <button id="column_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_20+'</button>\n                    <button id="column_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_21+"</button>\n                </fieldset>");return""!==n&&function(e,t,l){popupEasy.create(window.textWysiwyg.label_15,'<div id="wysiwyg_popup">'+l+"</div>",function(){if("button"===e){let e=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),l=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val();t.text(e),t.prop("href",l)}u()}),"table"===e&&($("#row_add").off("click").on("click","",function(){let e=t.parent().find(".mdc-layout-grid__cell").length,l='<div class="mdc-layout-grid__inner" contenteditable="false">';for(let t=0;t<e;t++)l+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';l+="</div>",t.parent().after(l),popupEasy.close(),u()}),$("#row_remove").off("click").on("click","",function(){t.parent().remove(),popupEasy.close(),u()}),$("#column_add").off("click").on("click","",function(){let e=t.index();$.each(t.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(t,l){$(l).find(".mdc-layout-grid__cell").eq(e).after('<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>')}),popupEasy.close(),u()}),$("#column_remove").off("click").on("click","",function(){let e=t.index();$.each(t.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(l,n){if(1===$(n).find(".mdc-layout-grid__cell").length)return t.parents(".mdc-layout-grid").remove(),!1;$(n).find(".mdc-layout-grid__cell").eq(e).remove()}),popupEasy.close(),u()}))}(t,l,n),!1}))},100)},this.historyClear=function(){n=[]},this.save=function(){c("source")}}