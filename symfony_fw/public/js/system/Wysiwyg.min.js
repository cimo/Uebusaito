var wysiwyg=new Wysiwyg;function Wysiwyg(){var i,d,n,a,c,o,e=this;function s(e){if("load"===e)0<$(d).length&&($(d).html($(i).val()),$(".wysiwyg").find(".source").text($(i).val()),n=$(i).val(),a.push(n),c=0);else if("source"===e){if(0<$(d).length){var t=$.trim($(d).html());$(i).val(t),$(".wysiwyg").find(".source").text(t)}}else if("editor"===e){var l=$(".wysiwyg").find(".source");0<l.length&&$(d).html(l.text())}var n}function r(t,e){"undo"===t?l():"redo"===t?p():"foreColor"===t||"backColor"===t||"unlink"===t||"formatBlock"===t||"fontSize"===t?(n.execCommand(t,!1,e),u()):"createLink"===t?popupEasy.create(window.textWysiwyg.label_5,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_6+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$("#wysiwyg_popup").find(".mdc-text-field__input").val();n.execCommand(t,!1,e),u()}):"insertImage"===t?popupEasy.create(window.textWysiwyg.label_7,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_8+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$("#wysiwyg_popup").find(".mdc-text-field__input").val();n.execCommand(t,!1,e),u()}):"custom_button_add"===t?popupEasy.create(window.textWysiwyg.label_9,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),t=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val();m(""===t?'<button class="mdc-button mdc-button--dense mdc-button--raised" type="button" contenteditable="false" style="display: block;">'+e+"</button>":'<a class="mdc-button mdc-button--dense mdc-button--raised" href="'+t+'" type="button" contenteditable="false">'+e+"</a>"),u()}):"custom_table_add"===t?popupEasy.create(window.textWysiwyg.label_12,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input row_number" type="text" value="1" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_13+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input column_number" type="text" value="4" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_14+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){for(var e=$("#wysiwyg_popup").find(".row_number").val(),t=$("#wysiwyg_popup").find(".column_number").val(),l='<div class="mdc-layout-grid" contenteditable="false">',n=0;n<e;n++){l+='<div class="mdc-layout-grid__inner" contenteditable="false">';for(var i=0;i<t;i++)l+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';l+="</div>"}m(l+="</div>"),u()}):(n.execCommand(t,!1,null),u())}function l(){if(0<=c){var e=a[--c];c<0&&(e=a[c=0]),$(d).html(e),!0}}function p(){if(c<a.length-1){var e=a[++c];$(d).html(e),!0}}function u(){var e,t;e=$(n).find(".mdc-button, .mdc-layout-grid"),$.each(e,function(e,t){0===$(t).prev("br").length&&$(t).before("<br>"),0===$(t).next("br").length&&$(t).after("<br>")}),t=$(n).find("br"),$.each(t,function(e,t){1===$(t).prev("br").length&&$(t).prev("br").remove(),1===$(t).next("br").length&&$(t).next("br").remove()});var l=$(d).html();l!==a[c]&&(c<a.length-1&&a.splice(c+1),a.push(l),o<++c&&a.shift())}function f(){var e=window.frames[0].document,t=null;return e.getSelection?t=e.getSelection().anchorNode:e.selection&&(t=e.selection.anchorNode),null!==t&&(t=3===t.nodeType?t.parentNode:t),t}function m(e){var t=window.frames[0].document,l=null;if(t.getSelection){if(selection=t.getSelection(),selection.getRangeAt&&selection.rangeCount){var n=window.frames[0].document.createElement("div");n.innerHTML=e;for(var i=window.frames[0].document.createDocumentFragment(),d=null;node=n.firstChild;)d=i.appendChild(node);(l=selection.getRangeAt(0)).deleteContents(),l.insertNode(i),d&&((l=l.cloneRange()).setStartAfter(d),l.collapse(!0),selection.removeAllRanges(),selection.addRange(l))}}else t.selection&&(selection=t.selection,"Control"!==selection.type&&(l=selection.createRange()).pasteHTML(e))}e.init=function(){i="",n=d=null,a=[],c=-1,!(o=300)},e.create=function(e,t){setTimeout(function(){i=e,$(i).parent().css("margin","0"),$(i).parent().hide(),$(t).click(function(){s("source")}),0<$(".wysiwyg").length&&($(".wysiwyg").find(".editor").contents().find("head").append("<style>\n                    html {\n                        padding: 5px !important;\n                        height: auto !important;\n                    }\n                    body div {\n                        margin: 0;\n                        min-height: 19px;\n                    }\n                    body .mdc-layout-grid {\n                        padding: 0;\n                    }\n                    body .mdc-layout-grid .mdc-layout-grid__cell {\n                        border: 1px solid #000000;\n                    }\n                </style>"),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto+Mono_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto_300_400_500_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-icons_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-components-web_custom.min.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/system/"+window.setting.template+".css",type:"text/css"})),d=$(".wysiwyg").find(".editor").contents().find("body")[0],n=$(".wysiwyg").find(".editor").contents()[0],$(d).addClass("mdc-typography"),$(d).prop("contenteditable","true"),$(d).off("click").on("click","a",function(e){e.preventDefault()}),n.execCommand("defaultParagraphSeparator",!1,"div"),s("load"),$(".wysiwyg").find(".toolbar .mdc-fab").off("click").on("click","",function(e){e.preventDefault();var t=!0===$(e.target).parent().hasClass("mdc-fab")?$(e.target).parent():$(e.target),l=t.find("span").data("command");"source"===l?"none"===$(".wysiwyg").find(".source").css("display")==!0?(s("source"),$(".wysiwyg").find(".editor").hide(),$(".wysiwyg").find(".source").show()):(s("editor"),$(".wysiwyg").find(".source").hide(),$(".wysiwyg").find(".editor").show()):"foreColor"===l||"backColor"===l?r(l,t.next().val()):r(l)}),$(".wysiwyg").find(".mdc-select .mdc-select__native-control").off("change").on("change","",function(e){e.preventDefault();var t=$(e.target).data("command");"formatBlock"!==t&&"fontSize"!==t||r(t,$(e.target).val())}),$(d).on("click","",function(e){!1;var t=f();!1===$(t).hasClass("mdc-layout-grid__cell")&&0===$(t).parents(".mdc-layout-grid__cell").length&&$(d).find(".mdc-layout-grid__cell").prop("contenteditable",!1)}),$(d).on("dblclick","",function(e){!1;var t=f();0<$(t).parents(".mdc-layout-grid__cell").length&&(t=$(t).parents(".mdc-layout-grid__cell")[0]),!0===$(t).hasClass("mdc-layout-grid__cell")&&($(d).find(".mdc-layout-grid__cell").prop("contenteditable",!1),$(t).prop("contenteditable",!0),$(t).focus())}),$(d).on("keydown","",function(e){if(e.ctrlKey||!0===e.metaKey){if(e.shiftKey&&90===e.keyCode)return p(),!1;if(90===e.keyCode)return l(),!1}}),$(d).on("keyup","",function(e){u()}),$(d).contextmenu(function(e){var l,n,t,i="",d=null,a="";if(!0===$(e.target).hasClass("mdc-button")){if(i="button",d=$(e.target),!0===$(e.target).is("button"))a='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+(c=$(e.target).text())+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>';else if(!0===$(e.target).is("a")){var c=$(e.target).text(),o=void 0===$(e.target).prop("href")?"":$(e.target).prop("href");a='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+c+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="'+o+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>'}}else(!0===$(e.target).hasClass("mdc-layout-grid__cell")||0<$(e.target).parents(".mdc-layout-grid__cell").length)&&(d=$(e.target),0<$(e.target).parents(".mdc-layout-grid__cell").length&&(d=$(e.target).parents(".mdc-layout-grid__cell")),i="table",a="<fieldset>\n                    <legend>"+window.textWysiwyg.label_16+'</legend>\n                    <button id="row_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_17+'</button>\n                    <button id="row_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_18+"</button>\n                </fieldset>\n                <fieldset>\n                    <legend>"+window.textWysiwyg.label_19+'</legend>\n                    <button id="column_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_20+'</button>\n                    <button id="column_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_21+"</button>\n                </fieldset>");return""!==a&&(l=i,n=d,t=a,popupEasy.create(window.textWysiwyg.label_15,'<div id="wysiwyg_popup">'+t+"</div>",function(){if("button"===l){var e=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),t=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val();n.text(e),n.prop("href",t)}u()}),"table"===l&&($("#row_add").off("click").on("click","",function(){for(var e=n.parent().find(".mdc-layout-grid__cell").length,t='<div class="mdc-layout-grid__inner" contenteditable="false">',l=0;l<e;l++)t+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';t+="</div>",n.parent().after(t),popupEasy.close(),u()}),$("#row_remove").off("click").on("click","",function(){n.parent().remove(),popupEasy.close(),u()}),$("#column_add").off("click").on("click","",function(){var l=n.index();$.each(n.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(e,t){$(t).find(".mdc-layout-grid__cell").eq(l).after('<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>')}),popupEasy.close(),u()}),$("#column_remove").off("click").on("click","",function(){var l=n.index();$.each(n.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(e,t){if(1===$(t).find(".mdc-layout-grid__cell").length)return n.parents(".mdc-layout-grid").remove(),!1;$(t).find(".mdc-layout-grid__cell").eq(l).remove()}),popupEasy.close(),u()}))),!1}))},100)},e.historyClear=function(){a=[]},e.save=function(){s("source")}}