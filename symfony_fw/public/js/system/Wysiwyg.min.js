"use strict";class Wysiwyg{constructor(){this.containerTag="",this.wysiwyg=null,this.iframeBody=null,this.iframeContent=null,this.currentTable=null,this.history=[],this.historyPosition=-1,this.historyLimit=300}create=(t,e)=>{let i=setTimeout(()=>{clearTimeout(i),this.containerTag=t,$(this.containerTag).parent().css("margin","0"),$(this.containerTag).parent().hide(),$(e).click(()=>{this._fillField("source")}),this._iframe()},100)};historyClear=()=>{this.history=[]};save=()=>{this._fillField("source")};_iframe=()=>{$(".wysiwyg").length>0&&($(".wysiwyg").find(".editor").contents().find("head").append("<style>                    html {                        padding: 5px !important;                        height: auto !important;                    }                    body div {                        margin: 0;                        min-height: 19px;                    }                    body .mdc-layout-grid {                        position: relative;                        padding: 0;                        margin: 10px 0 10px 0;                    }                    body .mdc-layout-grid .table_space_icon {                        position: absolute;                        display: none;                        background: #000000;                        width: 24px;                        height: 24px;                    }                    body .mdc-layout-grid .table_space_icon i {                        color: #ffffff;                        cursor: pointer;                    }                    body .mdc-layout-grid .mdc-layout-grid__inner {                        margin-bottom: 20px;                    }                    body .mdc-layout-grid .mdc-layout-grid__cell {                        border: 1px solid #000000;                    }                </style>"),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto+Mono_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto_300_400_500_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-icons_custom.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-components-web_custom.min.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:`${window.url.root}/css/system/${window.setting.template}.css`,type:"text/css"})),this.iframeBody=$(".wysiwyg").find(".editor").contents().find("body")[0],this.iframeContent=$(".wysiwyg").find(".editor").contents()[0],$(this.iframeBody).addClass("mdc-typography"),$(this.iframeBody).prop("contenteditable","true"),$(this.iframeBody).on("click","a",t=>{t.preventDefault()}),this.iframeContent.execCommand("defaultParagraphSeparator",!1,"div"),this._fillField("load"),this._toolbarEvent(),this._editorEvent())};_fillField=t=>{if("load"===t)$(this.iframeBody).length>0&&($(this.iframeBody).html($(this.containerTag).val()),$(".wysiwyg").find(".source").text($(this.containerTag).val()),this._historyLoad($(this.containerTag).val()));else if("source"===t){if($(this.iframeBody).length>0){let t=$.trim($(this.iframeBody).html());$(this.containerTag).val(t),$(".wysiwyg").find(".source").text(t)}}else if("editor"===t){let t=$(".wysiwyg").find(".source");t.length>0&&$(this.iframeBody).html(t.text())}};_toolbarEvent=()=>{$(".wysiwyg").find(".toolbar .mdc-fab").on("click","",t=>{t.preventDefault();let e=!0===$(t.target).parent().hasClass("mdc-fab")?$(t.target).parent():$(t.target),i=e.find("span").data("command");"source"===i?this._source():"foreColor"===i||"backColor"===i?this._executeCommand(i,e.next().val()):this._executeCommand(i)}),$(".wysiwyg").find(".mdc-select .mdc-select__native-control").on("change","",t=>{t.preventDefault();let e=$(t.target).data("command");"formatBlock"!==e&&"fontSize"!==e||this._executeCommand(e,$(t.target).val())})};_source=()=>{!0===("none"===$(".wysiwyg").find(".source").css("display"))?(this._fillField("source"),$(".wysiwyg").find(".editor").hide(),$(".wysiwyg").find(".source").show()):(this._fillField("editor"),$(".wysiwyg").find(".source").hide(),$(".wysiwyg").find(".editor").show())};_executeCommand=(t,e)=>{"undo"===t?this._historyUndo():"redo"===t?this._historyRedo():"foreColor"===t||"backColor"===t||"unlink"===t||"formatBlock"===t||"fontSize"===t?(this.iframeContent.execCommand(t,!1,e),this._historySave()):"createLink"===t?popupEasy.show(window.textWysiwyg.label_5,`<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_6}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>`,()=>{let e=$("#wysiwyg_popup").find(".mdc-text-field__input").val();this.iframeContent.execCommand(t,!1,e),this._historySave()}):"insertImage"===t?popupEasy.show(window.textWysiwyg.label_7,`<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_8}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>`,()=>{let e=$("#wysiwyg_popup").find(".mdc-text-field__input").val();this.iframeContent.execCommand(t,!1,e),this._historySave()}):"custom_button_add"===t?popupEasy.show(window.textWysiwyg.label_9,`<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_10}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_11}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>`,()=>{let t=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),e=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val(),i="";i=""===e?`<button class="mdc-button mdc-button--dense mdc-button--raised" type="button" contenteditable="false" style="display: block;">${t}</button>`:`<a class="mdc-button mdc-button--dense mdc-button--raised" href="${e}" type="button" contenteditable="false">${t}</a>`,this._addHtmlAtCaretPosition(i),this._historySave()}):"custom_table_add"===t?popupEasy.show(window.textWysiwyg.label_12,`<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input row_number" type="text" value="1" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_13}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input column_number" type="text" value="4" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_14}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>`,()=>{let t=$("#wysiwyg_popup").find(".row_number").val(),e=$("#wysiwyg_popup").find(".column_number").val(),i='<div class="mdc-layout-grid" contenteditable="false">                        <div class="table_space_icon">                            <i class="material-icons mdc-list-item__graphic">line_weight</i>                        </div>';for(let l=0;l<t;l++){i+='<div class="mdc-layout-grid__inner" contenteditable="false">';for(let t=0;t<e;t++)i+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';i+="</div>"}i+="</div>",this._addHtmlAtCaretPosition(i),this._historySave()}):(this.iframeContent.execCommand(t,!1,null),this._historySave())};_historyUndo=()=>{if(this.historyPosition>=0){let t=this.history[--this.historyPosition];this.historyPosition<0&&(this.historyPosition=0,t=this.history[this.historyPosition]),$(this.iframeBody).html(t)}};_historyRedo=()=>{if(this.historyPosition<this.history.length-1){let t=this.history[++this.historyPosition];$(this.iframeBody).html(t)}};_historySave=()=>{let t=$(this.iframeBody).html();t!==this.history[this.historyPosition]&&(this.historyPosition<this.history.length-1&&this.history.splice(this.historyPosition+1),this.history.push(t),this.historyPosition++,this.historyPosition>this.historyLimit&&this.history.shift())};_historyLoad=t=>{this.history.push(t),this.historyPosition=0};_editorEvent=()=>{$(this.iframeBody).on("click","",t=>{let e=this._findElementAtCaretPosition();!1===$(e).hasClass("mdc-layout-grid__cell")&&0===$(e).parents(".mdc-layout-grid__cell").length&&$(this.iframeBody).find(".mdc-layout-grid__cell").prop("contenteditable",!1)}),$(this.iframeBody).on("dblclick","",t=>{let e=this._findElementAtCaretPosition();$(e).parents(".mdc-layout-grid__cell").length>0&&(e=$(e).parents(".mdc-layout-grid__cell")[0]),!0===$(e).hasClass("mdc-layout-grid__cell")&&($(this.iframeBody).find(".mdc-layout-grid__cell").prop("contenteditable",!1),$(e).prop("contenteditable",!0),$(e).focus())}),$(this.iframeBody).on("keydown","",t=>{if(t.ctrlKey||!0===t.metaKey){if(t.shiftKey&&90===t.keyCode)return this._historyRedo(),!1;if(90===t.keyCode)return this._historyUndo(),!1}}),$(this.iframeBody).on("keyup","",t=>{this._historySave()}),$(this.iframeBody).on("mouseenter",".mdc-layout-grid",t=>{if(!0===$(t.target).hasClass("mdc-layout-grid__cell")){this.currentTable=$(t.target).parents(".mdc-layout-grid");let e=this.currentTable.find(".table_space_icon");e.css({top:22,left:0}),e.show()}}),$(this.iframeBody).on("mouseleave",".mdc-layout-grid",t=>{$(t.target).parents(".mdc-layout-grid").find(".table_space_icon").hide(),this.currentTable=null}),$(this.iframeBody).on("click",".mdc-layout-grid .table_space_icon",()=>{null!==this.currentTable&&(this._spaceOnElement(this.currentTable),this._historySave())}),$(this.iframeBody).contextmenu(t=>{let e="",i=null,l="";if(!0===$(t.target).hasClass("mdc-button")){if(e="button",i=$(t.target),!0===$(t.target).is("button")){l=`<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="${$(t.target).text()}" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_10}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>`}else if(!0===$(t.target).is("a")){l=`<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="${$(t.target).text()}" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">{window.textWysiwyg.label_10}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="${void 0===$(t.target).prop("href")?"":$(t.target).prop("href")}" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">${window.textWysiwyg.label_11}</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>`}}else(!0===$(t.target).hasClass("mdc-layout-grid__cell")||$(t.target).parents(".mdc-layout-grid__cell").length>0)&&(i=$(t.target),$(t.target).parents(".mdc-layout-grid__cell").length>0&&(i=$(t.target).parents(".mdc-layout-grid__cell")),e="table",l=`<fieldset>\n                    <legend>${window.textWysiwyg.label_16}</legend>\n                    <button id="row_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">${window.textWysiwyg.label_17}</button>\n                    <button id="row_remove" class="mdc-button mdc-button--dense mdc-button--raised button_warning" type="button">${window.textWysiwyg.label_18}</button>\n                </fieldset>\n                <fieldset>\n                    <legend>${window.textWysiwyg.label_19}</legend>\n                    <button id="column_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">${window.textWysiwyg.label_20}</button>\n                    <button id="column_remove" class="mdc-button mdc-button--dense mdc-button--raised button_warning" type="button">${window.textWysiwyg.label_21}</button>\n                </fieldset>`);return""!==l&&this._popupSetting(e,i,l),!1})};_popupSetting=(t,e,i)=>{popupEasy.show(window.textWysiwyg.label_15,`<div id="wysiwyg_popup">${i}</div>`,()=>{if("button"===t){let t=$("#wysiwyg_popup").find(".mdc-text-field__input.label").val(),i=$("#wysiwyg_popup").find(".mdc-text-field__input.link").val();e.text(t),e.prop("href",i)}this._historySave()}),"table"===t&&($("#row_add").on("click","",t=>{let i=e.parent().find(".mdc-layout-grid__cell").length,l='<div class="mdc-layout-grid__inner" contenteditable="false">';for(let t=0;t<i;t++)l+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';l+="</div>",e.parent().after(l),popupEasy.close(),this._historySave()}),$("#row_remove").on("click","",t=>{e.parent().remove(),popupEasy.close(),this._historySave()}),$("#column_add").on("click","",t=>{let i=e.index();$.each(e.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),(t,e)=>{$(e).find(".mdc-layout-grid__cell").eq(i).after('<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>')}),popupEasy.close(),this._historySave()}),$("#column_remove").on("click","",t=>{let i=e.index();$.each(e.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),(t,l)=>{if(1===$(l).find(".mdc-layout-grid__cell").length)return e.parents(".mdc-layout-grid").remove(),!1;$(l).find(".mdc-layout-grid__cell").eq(i).remove()}),popupEasy.close(),this._historySave()}))};_findElementAtCaretPosition=()=>{let t=window.frames[0].document,e=null,i=null;return t.getSelection()?(e=t.getSelection(),i=e.anchorNode):t.selection&&(e=t.selection,i=e.anchorNode),null!==i&&(i=3===i.nodeType?i.parentNode:i),i};_addHtmlAtCaretPosition=t=>{let e=window.frames[0].document,i=null,l=null;if(e.getSelection()){if(i=e.getSelection(),i.rangeCount>0&&i.getRangeAt(0)){let e=window.frames[0].document.createElement("div");e.innerHTML=t;let s=window.frames[0].document.createDocumentFragment(),d=null,n=null;for(;d=e.firstChild;)n=s.appendChild(d);l=i.getRangeAt(0),l.deleteContents(),l.insertNode(s),n&&(l=l.cloneRange(),l.setStartAfter(n),l.collapse(!0),i.removeAllRanges(),i.addRange(l))}}else e.selection&&(i=e.selection,"Control"!==i.type&&(l=i.createRange(),l.pasteHTML(t)))};_spaceOnElement=t=>{0===$(t).prev("br").length?$(t).before("<br><br>"):$(t).before("<br>"),0===$(t).next("br").length?$(t).after("<br><br>"):$(t).after("<br>")};_removeDoubleSpace=()=>{let t=$(this.iframeContent).find("br");$.each(t,(t,e)=>{1===$(e).prev("br").length&&$(e).prev("br").remove(),1===$(e).next("br").length&&$(e).next("br").remove()})}}