"use strict";class Chaato{set setBackgroundType(t){this.backgroundType=t}set setAnimationSpeed(t){this.animationSpeed=t}set setPadding(t){this.padding=t}set setTranslate(t){this.translate=t}set setScale(t){this.scale=t}constructor(){this.jsonResult={},this.canvas=null,this.canvasWidth=0,this.canvasHeight=0,this.context=null,this.labelSpace=0,this.itemMax=0,this.itemMaxKey=-1,this.itemSpace=0,this.itemPrevious=[],this.listItems=[],this.circleRange=2,this.backgroundType="grid",this.animationCount=0,this.animationSpeed=.5,this.mousePosition={},this.padding=30,this.translate=[95,20],this.scale=[.91,.88]}create=t=>{this.jsonResult=t,this.canvas=$(".graph_container").find(".canvas")[0],this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.context=this.canvas.getContext("2d"),this.labelSpace=Math.floor(this.canvasWidth/this.jsonResult.label.items.length);let e=[];$.each(this.jsonResult.elements,(t,i)=>{e[t]=Math.max.apply(null,this.jsonResult.elements[t].items)}),this.itemMax=Math.max.apply(null,e),this.itemMaxKey=this.indexOfMax(e),this.itemSpace=Math.floor(this.canvasHeight/this.jsonResult.elements[this.itemMaxKey].items.length)-1,this.render(),$(this.canvas).on("mousemove","",t=>{this.mousePosition=this.findMousePosition("canvas",t),this.info(t)})};render=()=>{this.context.translate(this.translate[0],this.translate[1]),this.context.scale(this.scale[0],this.scale[1]),this.axes(),this.background(),$.each(this.jsonResult.elements,(t,e)=>{$.each(e,(e,i)=>{"items"===e&&(this.listItems[t]=[],this.dataLine(t,this.jsonResult.elements[t].color,i))})})};axes=()=>{this.context.beginPath(),this.context.lineWidth=1,this.context.strokeStyle="#000000",this.context.moveTo(0,this.canvasHeight),this.context.lineTo(this.canvasWidth-this.labelSpace,this.canvasHeight),this.context.lineWidth=1,this.context.strokeStyle="#000000",this.context.moveTo(0,0),this.context.lineTo(0,this.canvasHeight),this.context.stroke()};background=()=>{let t=this.jsonResult.label.items;$.each(t,(t,e)=>{this.context.beginPath(),this.context.font="20px Arial",this.context.textAlign="center",this.context.strokeStyle="#000000",this.context.fillText(e,t*this.labelSpace,this.canvasHeight+this.padding+5),"grid"!==this.backgroundType&&"lineY"!==this.backgroundType||(this.context.lineWidth=1,this.context.strokeStyle="#e9e9e9",this.context.moveTo(t*this.labelSpace,0),this.context.lineTo(t*this.labelSpace,this.canvasHeight)),this.context.stroke()});let e=this.jsonResult.elements[this.itemMaxKey].items.length,i=Math.ceil(this.itemMax/t.length);i<2?i=1:2===i&&(i=3);for(let t=0;t<=this.itemMax+i;t+=i)this.context.beginPath(),this.context.font="20px Arial",this.context.textAlign="end",this.context.strokeStyle="#000000",this.context.fillText(t,-this.padding,this.canvasHeight-t*this.itemSpace/(this.itemMax/e)+5),"grid"!==this.backgroundType&&"lineX"!==this.backgroundType||(this.context.lineWidth=1,this.context.strokeStyle="#e9e9e9",this.context.moveTo(0,this.canvasHeight-t*this.itemSpace/(this.itemMax/e)),this.context.lineTo(this.canvasWidth-this.labelSpace,this.canvasHeight-t*this.itemSpace/(this.itemMax/e))),this.context.stroke()};dataLine=(t,e,i)=>{this.itemPrevious=[],0===this.animationSpeed?this.dataLineStatic(t,e,i):(this.animationCount=0,this.dataLineAnimation(t,e,i,this.itemPrevious,this.animationCount))};dataLineStatic=(t,e,i)=>{$.each(i,(i,s)=>{this.context.beginPath(),this.context.lineWidth=1,this.context.strokeStyle=e,this.context.lineCap="round",this.context.lineJoin="round";let n=i*this.labelSpace,h=this.canvasHeight-s*this.itemSpace/(this.itemMax/this.jsonResult.elements[this.itemMaxKey].items.length);this.context.moveTo(n,h),this.context.lineTo(this.itemPrevious[0],this.itemPrevious[1]),this.itemPrevious[0]=n,this.itemPrevious[1]=h,this.context.closePath(),this.context.stroke(),this.context.arc(n,h,5,0,this.circleRange*Math.PI),this.listItems[t][i]=[n,h],this.context.fill()})};dataLineAnimation=(t,e,i,s,n)=>{let h=n*this.labelSpace,a=this.canvasHeight-i[n]*this.itemSpace/(this.itemMax/this.jsonResult.elements[this.itemMaxKey].items.length),o=0,l=setInterval(()=>{o+=this.animationSpeed,o>1&&(o=1),this.context.beginPath(),this.context.lineWidth=1,this.context.strokeStyle=e,this.context.lineCap="round",this.context.lineJoin="round";let c=s[0]+(h-s[0])*o,r=s[1]+(a-s[1])*o;this.context.moveTo(s[0],s[1]),this.context.lineTo(c,r),this.context.closePath(),this.context.stroke(),(c===h&&r===a||0===s.length)&&(clearInterval(l),this.context.arc(h,a,5,0,this.circleRange*Math.PI),this.listItems[t][n-1]=[h,a],this.context.fill(),s[0]=h,s[1]=a,n<i.length&&this.dataLineAnimation(t,e,i,s,n))},30);n++};findMousePosition=(t,e)=>{let i=0,s=0;if("canvas"===t){let t=this.canvas.getBoundingClientRect();this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top,i=Math.floor(this.mouseX/t.width*this.canvas.width),s=Math.floor(this.mouseY/t.height*this.canvas.height)}else"client"===t&&(i=e.clientX-window.pageXOffset,s=e.clientY-window.pageYOffset);return{x:i,y:s}};info=t=>{$(".graph_container").find(".info").css({top:t.offsetY+20,left:t.offsetX+20}),$(".graph_container").find(".info").hide(),$.each(this.listItems,(t,e)=>{$.each(e,(e,i)=>{let s=(this.mousePosition.x-(this.translate[0]+this.circleRange))/this.scale[0],n=(this.mousePosition.y-(this.translate[1]+this.circleRange))/this.scale[1],h=Math.pow(i[0]-s,2),a=Math.pow(i[1]-n,2);Math.floor(Math.sqrt(h+a))<=10&&($(".graph_container").find(".info p span").eq(0).text(this.jsonResult.label.name),$(".graph_container").find(".info p span").eq(1).text(this.jsonResult.elements[t].name[e]),$(".graph_container").find(".info p span").eq(2).text(this.jsonResult.elements[t].items[e]),$(".graph_container").find(".info").show())})})};indexOfMax=t=>{if(0===t.length)return-1;let e=t[0],i=0;for(let s=1;s<t.length;s++)t[s]>e&&(i=s,e=t[s]);return i}}