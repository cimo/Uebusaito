var uploadChunk=new UploadChunk;function UploadChunk(){var n,t,a,i,r,s,p,l,e,u,o,d,c,f=this;function h(e){if(null!==p){var s=new FormData;s.append("file",e);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.uploadChunk?e.response.uploadChunk.processFile:e.response;void 0!==s.messages.error?(g(),flashBag.show(s.messages.error)):"send"===s.status&&!1===d&&(u<p.size?m():function(){if(null===p)return;materialDesign.linearProgress(a,u,p.size);var e=new FormData,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.uploadChunk?e.response.uploadChunk.processFile:e.response;void 0!==s.messages.error?(g(),flashBag.show(s.messages.error)):"complete"===s.status&&(g(),""!==i&&helper.imageRefresh(i,1),""!==r&&function s(e){$(".loader_back").show();$(t).find(".popupWait").show();ajax.send(!1,r,"post",{lockName:e},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,function(e){ajax.reply(e,""),void 0!==e.response.status&&($(t).find(".popupWait .close").off("click").on("click","",function(){!1===$(t).find(".popupWait .close").prop("disabled")&&($(".loader_back").hide(),$(t).find(".popupWait .result").html(""),$(t).find(".popupWait .result").hide(),$(t).find(".popupWait .content").show(),$(t).find(".popupWait").hide())}),void 0!==e.response.values&&null!==e.response.values.count&&($(t).find(".popupWait .content .status").html(e.response.values.count+"/"+e.response.values.total),materialDesign.linearProgress(t+" .popupWait .content .mdc-linear-progress",e.response.values.count,e.response.values.total)),"error"===e.response.status?($(t).find(".popupWait .close").prop("disabled",!1),$(t).find(".popupWait .content .status").html(""),materialDesign.linearProgress(t+" .popupWait .content .mdc-linear-progress",0,0),$(t).find(".popupWait .content").hide(),$(t).find(".popupWait .result").show(),$(t).find(".popupWait .result").html("<p>"+window.textUploadChunk.label_1+"</p>")):"finish"===e.response.status?($(t).find(".popupWait .close").prop("disabled",!1),$(t).find(".popupWait .content .status").html(""),materialDesign.linearProgress(t+" .popupWait .content .mdc-linear-progress",0,0),$(t).find(".popupWait .content").hide(),$(t).find(".popupWait .result").show(),$(t).find(".popupWait .result").html("<p>"+window.textUploadChunk.label_2+"</p>")):"loop"===e.response.status&&s(e.response.values.lockName))},null,null)}(e.response.values.lockName),void 0!==s.messages.success&&flashBag.show(s.messages.success),null!==c&&c())}},o.open("post",n+"&action=complete&fileName="+l),o.send(e)}())}},o.open("post",n+"&action=send&fileName="+l),o.send(s)}}function m(){null!==p&&(h(p.slice(u,o)),materialDesign.linearProgress(a,u,p.size),o=(u=o)+e)}function g(){p=null,l="",u=0,o=e=1048576,$(t).find(".upload_chunk .file").val(""),$(t).find(".upload_chunk .mdc-linear-progress").hide(),$(t).find(".controls .button_start").attr("disabled",!1),$(t).find(".controls .button_stop").attr("disabled",!0),$(t).find(".controls").hide(),$(t).find(".material_upload label").text(s)}f.setUrlRequest=function(e){n=e},f.setTagContainer=function(e){t=e},f.setTagProgressBar=function(e){a=e},f.setTagImageRefresh=function(e){i=e},f.setLockUrl=function(e){r=e},f.init=function(){l=s=r=a=i=t=n="",u=0,o=e=1048576,d=!1,c=p=null},f.processFile=function(e){void 0!==e&&(c=e),s=$(t).find(".material_upload label").text(),$(t).find(".upload_chunk .file").on("change","",function(){p=$(this)[0].files[0],l=p.name,function(){if(null===p)return;$(t).find(".controls").show(),$(t).find(".controls .button_start").off("click").on("click","",function(){!function(){if(null===p)return;$(t).find(".controls .button_start").prop("disabled",!1),$(t).find(".controls .button_stop").prop("disabled",!0);var e=new FormData,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.uploadChunk?e.response.uploadChunk.processFile:e.response;void 0!==s.messages.error?(g(),flashBag.show(s.messages.error)):"start"===s.status&&(d=!1,$(t).find(".upload_chunk .mdc-linear-progress").show(),$(t).find(".controls .button_start").prop("disabled",!0),$(t).find(".controls .button_stop").prop("disabled",!1),m())}},o.open("post",n+"&action=start&fileName="+l),o.send(e)}()}),$(t).find(".controls .button_stop").off("click").on("click","",function(){!function(){if(null===p)return;d=!0,$(t).find(".controls .button_start").attr("disabled",!1),$(t).find(".controls .button_stop").attr("disabled",!0);var e=new FormData,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.uploadChunk?e.response.uploadChunk.processFile:e.response;void 0!==s.messages.error?(g(),flashBag.show(s.messages.error)):"stop"===s.status&&(g(),void 0!==s.messages.success&&flashBag.show(s.messages.success))}},o.open("post",n+"&action=stop&fileName="+l),o.send(e)}()})}()})}}