"use strict";class UploadChunk{set setUrlRequest(t){this.urlRequest=t}set setTagContainer(t){this.tagContainer=t}set setTagProgressBar(t){this.tagProgressBar=t}set setTagImageRefresh(t){this.tagImageRefresh=t}constructor(){this.urlRequest="",this.tagContainer="",this.tagProgressBar="",this.tagImageRefresh="",this.inputLabel="",this.byteChunkInit=1048576,this.file=null,this.fileName="",this.byteChunk=this.byteChunkInit,this.sizeStart=0,this.sizeEnd=this.byteChunk,this.isStop=!1,this.callbackComplete=null}processFile=t=>{void 0!==t&&(this.callbackComplete=t),this.inputLabel=$(this.tagContainer).find(".material_upload label").text(),$(this.tagContainer).find(".upload_chunk .file").on("change","",t=>{this.file=$(t.target)[0].files[0],this.fileName=this.file.name,this._ready()})};_ready=()=>{null!==this.file&&($(this.tagContainer).find(".controls").show(),$(this.tagContainer).find(".controls .button_start").on("click","",t=>{this._start()}),$(this.tagContainer).find(".controls .button_stop").on("click","",t=>{this._stop()}))};_start=()=>{if(null===this.file)return;$(this.tagContainer).find(".controls .button_start").prop("disabled",!1),$(this.tagContainer).find(".controls .button_stop").prop("disabled",!0);let t=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let t=JSON.parse(e.response),s=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==s.messages.error?(this._resetValue(),flashBag.show(s.messages.error)):"start"===s.status&&(this.isStop=!1,$(this.tagContainer).find(".upload_chunk .mdc-linear-progress").show(),$(this.tagContainer).find(".controls .button_start").prop("disabled",!0),$(this.tagContainer).find(".controls .button_stop").prop("disabled",!1),this._chunk())}},e.open("post",`${this.urlRequest}&action=start&fileName=${this.fileName}`),e.send(t)};_send=t=>{if(null===this.file)return;let e=new FormData;e.append("file",t);let s=new XMLHttpRequest;s.onreadystatechange=()=>{if(4===s.readyState){let t=JSON.parse(s.response),e=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==e.messages.error?(this._resetValue(),flashBag.show(e.messages.error)):"send"===e.status&&!1===this.isStop&&(this.sizeStart<this.file.size?this._chunk():this._complete())}},s.open("post",`${this.urlRequest}&action=send&fileName=${this.fileName}`),s.send(e)};_complete=()=>{if(null===this.file)return;materialDesign.linearProgress(this.tagProgressBar,this.sizeStart,this.file.size);let t=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let t=JSON.parse(e.response),s=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==s.messages.error?(this._resetValue(),flashBag.show(s.messages.error)):"complete"===s.status&&(this._resetValue(),""!==this.tagImageRefresh&&helper.imageRefresh(this.tagImageRefresh,1),void 0!==s.messages.success&&flashBag.show(s.messages.success),null!==this.callbackComplete&&this.callbackComplete())}},e.open("post",`${this.urlRequest}&action=complete&fileName=${this.fileName}`),e.send(t)};_stop=()=>{if(null===this.file)return;this.isStop=!0,$(this.tagContainer).find(".controls .button_start").attr("disabled",!1),$(this.tagContainer).find(".controls .button_stop").attr("disabled",!0);let t=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let t=JSON.parse(e.response),s=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==s.messages.error?(this._resetValue(),flashBag.show(s.messages.error)):"stop"===s.status&&(this._resetValue(),void 0!==s.messages.success&&flashBag.show(s.messages.success))}},e.open("post",`${this.urlRequest}&action=stop&fileName=${this.fileName}`),e.send(t)};_chunk=()=>{if(null===this.file)return;let t=this.file.slice(this.sizeStart,this.sizeEnd);this._send(t),materialDesign.linearProgress(this.tagProgressBar,this.sizeStart,this.file.size),this.sizeStart=this.sizeEnd,this.sizeEnd=this.sizeStart+this.byteChunk};_resetValue=()=>{this.file=null,this.fileName="",this.byteChunk=this.byteChunkInit,this.sizeStart=0,this.sizeEnd=this.byteChunk,$(this.tagContainer).find(".upload_chunk .file").val(""),$(this.tagContainer).find(".upload_chunk .mdc-linear-progress").hide(),$(this.tagContainer).find(".controls .button_start").attr("disabled",!1),$(this.tagContainer).find(".controls .button_stop").attr("disabled",!0),$(this.tagContainer).find(".controls").hide(),$(this.tagContainer).find(".material_upload label").text(this.inputLabel)}}