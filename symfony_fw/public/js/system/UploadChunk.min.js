"use strict";class UploadChunk{set setUrlRequest(t){this.urlRequest=t}set setTagContainer(t){this.tagContainer=t}set setTagProgressBar(t){this.tagProgressBar=t}set setTagImageRefresh(t){this.tagImageRefresh=t}set setLockUrl(t){this.lockUrl=t}constructor(){this.urlRequest="",this.tagContainer="",this.tagProgressBar="",this.tagImageRefresh="",this.lockUrl="",this.inputLabel="",this.byteChunkInit=1048576,this.file=null,this.fileName="",this.byteChunk=this.byteChunkInit,this.sizeStart=0,this.sizeEnd=this.byteChunk,this.isStop=!1,this.callbackComplete=null}processFile=t=>{void 0!==t&&(this.callbackComplete=t),this.inputLabel=$(this.tagContainer).find(".material_upload label").text(),$(this.tagContainer).find(".upload_chunk .file").on("change","",t=>{this.file=$(t.target)[0].files[0],this.fileName=this.file.name,this.ready()})};ready=()=>{null!==this.file&&($(this.tagContainer).find(".controls").show(),$(this.tagContainer).find(".controls .button_start").off("click").on("click","",t=>{this.start()}),$(this.tagContainer).find(".controls .button_stop").off("click").on("click","",t=>{this.stop()}))};start=()=>{if(null===this.file)return;$(this.tagContainer).find(".controls .button_start").prop("disabled",!1),$(this.tagContainer).find(".controls .button_stop").prop("disabled",!0);let t=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let t=JSON.parse(e.response),s=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==s.messages.error?(this.resetValue(),flashBag.show(s.messages.error)):"start"===s.status&&(this.isStop=!1,$(this.tagContainer).find(".upload_chunk .mdc-linear-progress").show(),$(this.tagContainer).find(".controls .button_start").prop("disabled",!0),$(this.tagContainer).find(".controls .button_stop").prop("disabled",!1),this.chunk())}},e.open("post",`${this.urlRequest}&action=start&fileName=${this.fileName}`),e.send(t)};send=t=>{if(null===this.file)return;let e=new FormData;e.append("file",t);let s=new XMLHttpRequest;s.onreadystatechange=()=>{if(4===s.readyState){let t=JSON.parse(s.response),e=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==e.messages.error?(this.resetValue(),flashBag.show(e.messages.error)):"send"===e.status&&!1===this.isStop&&(this.sizeStart<this.file.size?this.chunk():this.complete())}},s.open("post",`${this.urlRequest}&action=send&fileName=${this.fileName}`),s.send(e)};complete=()=>{if(null===this.file)return;materialDesign.linearProgress(this.tagProgressBar,this.sizeStart,this.file.size);let t=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let t=JSON.parse(e.response),s=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==s.messages.error?(this.resetValue(),flashBag.show(s.messages.error)):"complete"===s.status&&(this.resetValue(),""!==this.tagImageRefresh&&helper.imageRefresh(this.tagImageRefresh,1),""!==this.lockUrl&&this.lock(t.response.values.lockName),void 0!==s.messages.success&&flashBag.show(s.messages.success),null!==this.callbackComplete&&this.callbackComplete())}},e.open("post",`${this.urlRequest}&action=complete&fileName=${this.fileName}`),e.send(t)};stop=()=>{if(null===this.file)return;this.isStop=!0,$(this.tagContainer).find(".controls .button_start").attr("disabled",!1),$(this.tagContainer).find(".controls .button_stop").attr("disabled",!0);let t=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let t=JSON.parse(e.response),s=void 0!==t.response.uploadChunk?t.response.uploadChunk.processFile:t.response;void 0!==s.messages.error?(this.resetValue(),flashBag.show(s.messages.error)):"stop"===s.status&&(this.resetValue(),void 0!==s.messages.success&&flashBag.show(s.messages.success))}},e.open("post",`${this.urlRequest}&action=stop&fileName=${this.fileName}`),e.send(t)};chunk=()=>{if(null===this.file)return;let t=this.file.slice(this.sizeStart,this.sizeEnd);this.send(t),materialDesign.linearProgress(this.tagProgressBar,this.sizeStart,this.file.size),this.sizeStart=this.sizeEnd,this.sizeEnd=this.sizeStart+this.byteChunk};lock=t=>{$(".loader_back").show(),$(this.tagContainer).find(".popupWait").show(),ajax.send(!1,this.lockUrl,"post",{lockName:t},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,t=>{ajax.reply(t,""),void 0!==t.response.status&&($(this.tagContainer).find(".popupWait .close").off("click").on("click","",t=>{!1===$(this.tagContainer).find(".popupWait .close").prop("disabled")&&($(".loader_back").hide(),$(this.tagContainer).find(".popupWait .result").html(""),$(this.tagContainer).find(".popupWait .result").hide(),$(this.tagContainer).find(".popupWait .content").show(),$(this.tagContainer).find(".popupWait").hide())}),void 0!==t.response.values&&null!==t.response.values.count&&($(this.tagContainer).find(".popupWait .content .status").html(t.response.values.count+"/"+t.response.values.total),materialDesign.linearProgress(this.tagContainer+" .popupWait .content .mdc-linear-progress",t.response.values.count,t.response.values.total)),"error"===t.response.status?($(this.tagContainer).find(".popupWait .close").prop("disabled",!1),$(this.tagContainer).find(".popupWait .content .status").html(""),materialDesign.linearProgress(this.tagContainer+" .popupWait .content .mdc-linear-progress",0,0),$(this.tagContainer).find(".popupWait .content").hide(),$(this.tagContainer).find(".popupWait .result").show(),$(this.tagContainer).find(".popupWait .result").html("<p>"+window.textUploadChunk.label_1+"</p>")):"finish"===t.response.status?($(this.tagContainer).find(".popupWait .close").prop("disabled",!1),$(this.tagContainer).find(".popupWait .content .status").html(""),materialDesign.linearProgress(this.tagContainer+" .popupWait .content .mdc-linear-progress",0,0),$(this.tagContainer).find(".popupWait .content").hide(),$(this.tagContainer).find(".popupWait .result").show(),$(this.tagContainer).find(".popupWait .result").html("<p>"+window.textUploadChunk.label_2+"</p>")):"loop"===t.response.status&&this.lock(t.response.values.lockName))},null,null)};resetValue=()=>{this.file=null,this.fileName="",this.byteChunk=this.byteChunkInit,this.sizeStart=0,this.sizeEnd=this.byteChunk,$(this.tagContainer).find(".upload_chunk .file").val(""),$(this.tagContainer).find(".upload_chunk .mdc-linear-progress").hide(),$(this.tagContainer).find(".controls .button_start").attr("disabled",!1),$(this.tagContainer).find(".controls .button_stop").attr("disabled",!0),$(this.tagContainer).find(".controls").hide(),$(this.tagContainer).find(".material_upload label").text(this.inputLabel)}}