"use strict";class UploadChunk{set setUrlRequest(s){this.urlRequest=s}set setTagContainer(s){this.tagContainer=s}set setTagProgressBar(s){this.tagProgressBar=s}set setTagImageRefresh(s){this.tagImageRefresh=s}set setProcessLock(s){this.processLock=s}constructor(){this.urlRequest="",this.tagContainer="",this.tagProgressBar="",this.tagImageRefresh="",this.processLock=!1,this.inputLabel="",this.byteChunkInit=1048576,this.file=null,this.fileName="",this.byteChunk=this.byteChunkInit,this.sizeStart=0,this.sizeEnd=this.byteChunk,this.isStop=!1,this.callbackComplete=null}processFile=s=>{void 0!==s&&(this.callbackComplete=s),this.inputLabel=$(this.tagContainer).find(".material_upload label").text(),$(this.tagContainer).find(".upload_chunk .file").on("change","",s=>{this.file=$(s.target)[0].files[0],this.fileName=this.file.name,this.ready()})};ready=()=>{null!==this.file&&($(this.tagContainer).find(".controls").show(),$(this.tagContainer).find(".controls .button_start").off("click").on("click","",s=>{this.start()}),$(this.tagContainer).find(".controls .button_stop").off("click").on("click","",s=>{this.stop()}))};start=()=>{if(null===this.file)return;$(this.tagContainer).find(".controls .button_start").prop("disabled",!1),$(this.tagContainer).find(".controls .button_stop").prop("disabled",!0);let s=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let s=JSON.parse(e.response),t=void 0!==s.response.uploadChunk?s.response.uploadChunk.processFile:s.response;void 0!==t.messages.error?(this.resetValue(),flashBag.show(t.messages.error)):"start"===t.status&&(this.isStop=!1,$(this.tagContainer).find(".upload_chunk .mdc-linear-progress").show(),$(this.tagContainer).find(".controls .button_start").prop("disabled",!0),$(this.tagContainer).find(".controls .button_stop").prop("disabled",!1),this.chunk())}},e.open("post",`${this.urlRequest}&action=start&fileName=${this.fileName}`),e.send(s)};send=s=>{if(null===this.file)return;let e=new FormData;e.append("file",s);let t=new XMLHttpRequest;t.onreadystatechange=()=>{if(4===t.readyState){let s=JSON.parse(t.response),e=void 0!==s.response.uploadChunk?s.response.uploadChunk.processFile:s.response;void 0!==e.messages.error?(this.resetValue(),flashBag.show(e.messages.error)):"send"===e.status&&!1===this.isStop&&(this.sizeStart<this.file.size?this.chunk():this.complete())}},t.open("post",`${this.urlRequest}&action=send&fileName=${this.fileName}`),t.send(e)};complete=()=>{if(null===this.file)return;materialDesign.linearProgress(this.tagProgressBar,this.sizeStart,this.file.size);let s=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let s=JSON.parse(e.response),t=void 0!==s.response.uploadChunk?s.response.uploadChunk.processFile:s.response;void 0!==t.messages.error?(this.resetValue(),flashBag.show(t.messages.error)):"complete"===t.status&&(this.resetValue(),""!==this.tagImageRefresh&&helper.imageRefresh(this.tagImageRefresh,1),!0===this.processLock&&processLock.execute(this.tagContainer,s.response.processLock.name),void 0!==t.messages.success&&flashBag.show(t.messages.success),null!==this.callbackComplete&&this.callbackComplete())}},e.open("post",`${this.urlRequest}&action=complete&fileName=${this.fileName}`),e.send(s)};stop=()=>{if(null===this.file)return;this.isStop=!0,$(this.tagContainer).find(".controls .button_start").attr("disabled",!1),$(this.tagContainer).find(".controls .button_stop").attr("disabled",!0);let s=new FormData,e=new XMLHttpRequest;e.onreadystatechange=()=>{if(4===e.readyState){let s=JSON.parse(e.response),t=void 0!==s.response.uploadChunk?s.response.uploadChunk.processFile:s.response;void 0!==t.messages.error?(this.resetValue(),flashBag.show(t.messages.error)):"stop"===t.status&&(this.resetValue(),void 0!==t.messages.success&&flashBag.show(t.messages.success))}},e.open("post",`${this.urlRequest}&action=stop&fileName=${this.fileName}`),e.send(s)};chunk=()=>{if(null===this.file)return;let s=this.file.slice(this.sizeStart,this.sizeEnd);this.send(s),materialDesign.linearProgress(this.tagProgressBar,this.sizeStart,this.file.size),this.sizeStart=this.sizeEnd,this.sizeEnd=this.sizeStart+this.byteChunk};resetValue=()=>{this.file=null,this.fileName="",this.byteChunk=this.byteChunkInit,this.sizeStart=0,this.sizeEnd=this.byteChunk,$(this.tagContainer).find(".upload_chunk .file").val(""),$(this.tagContainer).find(".upload_chunk .mdc-linear-progress").hide(),$(this.tagContainer).find(".controls .button_start").attr("disabled",!1),$(this.tagContainer).find(".controls .button_stop").attr("disabled",!0),$(this.tagContainer).find(".controls").hide(),$(this.tagContainer).find(".material_upload label").text(this.inputLabel)}}