"use strict";const uploadChunk=new UploadChunk;function UploadChunk(){let e,s,t,n,o,a,i,r,l,p,u,d,c;function f(a){if(null===i)return;let l=new FormData;l.append("file",a);let u=new XMLHttpRequest;u.onreadystatechange=function(){if(4===u.readyState){let a=JSON.parse(u.response),l=void 0!==a.response.uploadChunk?a.response.uploadChunk.processFile:a.response;void 0!==l.messages.error?(m(),flashBag.show(l.messages.error)):"send"===l.status&&!1===d&&(p<i.size?h():function(){if(null===i)return;materialDesign.linearProgress(t,p,i.size);let a=new FormData,l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===l.readyState){let e=JSON.parse(l.response),t=void 0!==e.response.uploadChunk?e.response.uploadChunk.processFile:e.response;void 0!==t.messages.error?(m(),flashBag.show(t.messages.error)):"complete"===t.status&&(m(),""!==n&&helper.imageRefresh(n,1),""!==o&&function e(t){$(".loader_back").show();$(s).find(".popupWait").show();ajax.send(!1,o,"post",{lockName:t},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,function(t){ajax.reply(t,""),void 0!==t.response.status&&($(s).find(".popupWait .close").off("click").on("click","",function(){!1===$(s).find(".popupWait .close").prop("disabled")&&($(".loader_back").hide(),$(s).find(".popupWait .result").html(""),$(s).find(".popupWait .result").hide(),$(s).find(".popupWait .content").show(),$(s).find(".popupWait").hide())}),void 0!==t.response.values&&null!==t.response.values.count&&($(s).find(".popupWait .content .status").html(t.response.values.count+"/"+t.response.values.total),materialDesign.linearProgress(s+" .popupWait .content .mdc-linear-progress",t.response.values.count,t.response.values.total)),"error"===t.response.status?($(s).find(".popupWait .close").prop("disabled",!1),$(s).find(".popupWait .content .status").html(""),materialDesign.linearProgress(s+" .popupWait .content .mdc-linear-progress",0,0),$(s).find(".popupWait .content").hide(),$(s).find(".popupWait .result").show(),$(s).find(".popupWait .result").html("<p>"+window.textUploadChunk.label_1+"</p>")):"finish"===t.response.status?($(s).find(".popupWait .close").prop("disabled",!1),$(s).find(".popupWait .content .status").html(""),materialDesign.linearProgress(s+" .popupWait .content .mdc-linear-progress",0,0),$(s).find(".popupWait .content").hide(),$(s).find(".popupWait .result").show(),$(s).find(".popupWait .result").html("<p>"+window.textUploadChunk.label_2+"</p>")):"loop"===t.response.status&&e(t.response.values.lockName))},null,null)}(e.response.values.lockName),void 0!==t.messages.success&&flashBag.show(t.messages.success),null!==c&&c())}},l.open("post",e+"&action=complete&fileName="+r),l.send(a)}())}},u.open("post",e+"&action=send&fileName="+r),u.send(l)}function h(){if(null===i)return;f(i.slice(p,u)),materialDesign.linearProgress(t,p,i.size),u=(p=u)+l}function m(){i=null,r="",p=0,u=l=1048576,$(s).find(".upload_chunk .file").val(""),$(s).find(".upload_chunk .mdc-linear-progress").hide(),$(s).find(".controls .button_start").attr("disabled",!1),$(s).find(".controls .button_stop").attr("disabled",!0),$(s).find(".controls").hide(),$(s).find(".material_upload label").text(a)}this.setUrlRequest=function(s){e=s},this.setTagContainer=function(e){s=e},this.setTagProgressBar=function(e){t=e},this.setTagImageRefresh=function(e){n=e},this.setLockUrl=function(e){o=e},this.init=function(){e="",s="",n="",t="",o="",a="",i=null,r="",p=0,u=l=1048576,d=!1,c=null},this.processFile=function(t){void 0!==t&&(c=t),a=$(s).find(".material_upload label").text(),$(s).find(".upload_chunk .file").on("change","",function(){i=$(this)[0].files[0],r=i.name,function(){if(null===i)return;$(s).find(".controls").show(),$(s).find(".controls .button_start").off("click").on("click","",function(){!function(){if(null===i)return;$(s).find(".controls .button_start").prop("disabled",!1),$(s).find(".controls .button_stop").prop("disabled",!0);let t=new FormData,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){let e=JSON.parse(n.response),t=void 0!==e.response.uploadChunk?e.response.uploadChunk.processFile:e.response;void 0!==t.messages.error?(m(),flashBag.show(t.messages.error)):"start"===t.status&&(d=!1,$(s).find(".upload_chunk .mdc-linear-progress").show(),$(s).find(".controls .button_start").prop("disabled",!0),$(s).find(".controls .button_stop").prop("disabled",!1),h())}},n.open("post",e+"&action=start&fileName="+r),n.send(t)}()}),$(s).find(".controls .button_stop").off("click").on("click","",function(){!function(){if(null===i)return;d=!0,$(s).find(".controls .button_start").attr("disabled",!1),$(s).find(".controls .button_stop").attr("disabled",!0);let t=new FormData,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){let e=JSON.parse(n.response),s=void 0!==e.response.uploadChunk?e.response.uploadChunk.processFile:e.response;void 0!==s.messages.error?(m(),flashBag.show(s.messages.error)):"stop"===s.status&&(m(),void 0!==s.messages.success&&flashBag.show(s.messages.success))}},n.open("post",e+"&action=stop&fileName="+r),n.send(t)}()})}()})}}