var upload=new Upload;function Upload(){var t,n,a,r,i,e,l,p,s,d,o=this;function u(e){if(null!==l){var s=new FormData;s.append("file",e);var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.upload?e.response.upload.processFile:e.response;void 0!==s.messages.error?(f(),flashBag.show(s.messages.error)):"send"===s.status&&!1===d&&(sizeStart<l.size?c():function(){if(null===l)return;materialDesign.linearProgress(a,sizeStart,l.size);var e=new FormData,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.upload?e.response.upload.processFile:e.response;void 0!==s.messages.error?(f(),flashBag.show(s.messages.error)):"complete"===s.status&&(f(),""!==r&&utility.imageRefresh(r,1),""!==i&&function s(e){$(".loader_back").show();$(n).find(".popupWait").show();ajax.send(!1,i,"post",{lockName:e},"json",!1,!0,"application/x-www-form-urlencoded; charset=UTF-8",null,function(e){ajax.reply(e,""),void 0!==e.response.status&&($(n).find(".popupWait .close").off("click").on("click","",function(){!1===$(n).find(".popupWait .close").prop("disabled")&&($(".loader_back").hide(),$(n).find(".popupWait").hide())}),void 0!==e.response.values&&materialDesign.linearProgress(n+" .popupWait .mdc-linear-progress",e.response.values.count,e.response.values.total),"error"===e.response.status?($(n).find(".popupWait .close").prop("disabled",!1),$(n).find(".popupWait .content").html("<p>"+window.textUpload.label_1+"</p>")):"finish"===e.response.status?($(n).find(".popupWait .close").prop("disabled",!1),$(n).find(".popupWait .content").html("<p>"+window.textUpload.label_2+"</p>")):"loop"===e.response.status&&s(e.response.values.lockName))},null,null)}(e.response.values.lockName),void 0!==s.messages.success&&flashBag.show(s.messages.success))}},o.open("post",t+"&action=complete&fileName="+p),o.send(e)}())}},o.open("post",t+"&action=send&fileName="+p),o.send(s)}}function c(){null!==l&&(u(l.slice(sizeStart,sizeEnd)),materialDesign.linearProgress(a,sizeStart,l.size),sizeStart=sizeEnd,sizeEnd=sizeStart+s)}function f(){l=null,p="",s=1048576,sizeStart=0,sizeEnd=s,$(n).find(".upload_chunk .file").val(""),$(n).find(".upload_chunk .mdc-linear-progress").hide(),$(n).find(".controls .button_start").attr("disabled",!1),$(n).find(".controls .button_stop").attr("disabled",!0),$(n).find(".controls").hide(),$(n).find(".material_upload label").text(e)}o.setUrlRequest=function(e){t=e},o.setTagContainer=function(e){n=e},o.setTagProgressBar=function(e){a=e},o.setTagImageRefresh=function(e){r=e},o.setLockUrl=function(e){i=e},o.init=function(){l=null,p=e=i=a=r=n=t="",s=1048576,sizeStart=0,sizeEnd=s,d=!1},o.processFile=function(){e=$(n).find(".material_upload label").text(),$(n).find(".upload_chunk .file").on("change","",function(){l=$(this)[0].files[0],p=l.name,function(){if(null===l)return;$(n).find(".controls").show(),$(n).find(".controls .button_start").off("click").on("click","",function(){!function(){if(null===l)return;$(n).find(".controls .button_start").prop("disabled",!1),$(n).find(".controls .button_stop").prop("disabled",!0);var e=new FormData,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.upload?e.response.upload.processFile:e.response;void 0!==s.messages.error?(f(),flashBag.show(s.messages.error)):"start"===s.status&&(d=!1,$(n).find(".upload_chunk .mdc-linear-progress").show(),$(n).find(".controls .button_start").prop("disabled",!0),$(n).find(".controls .button_stop").prop("disabled",!1),c())}},o.open("post",t+"&action=start&fileName="+p),o.send(e)}()}),$(n).find(".controls .button_stop").off("click").on("click","",function(){!function(){if(null===l)return;d=!0,$(n).find(".controls .button_start").attr("disabled",!1),$(n).find(".controls .button_stop").attr("disabled",!0);var e=new FormData,o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===o.readyState){var e=JSON.parse(o.response),s=void 0!==e.response.upload?e.response.upload.processFile:e.response;void 0!==s.messages.error?(f(),flashBag.show(s.messages.error)):"stop"===s.status&&(f(),void 0!==s.messages.success&&flashBag.show(s.messages.success))}},o.open("post",t+"&action=stop&fileName="+p),o.send(e)}()})}()})}}