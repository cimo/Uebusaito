var upload=new Upload;function Upload(){var a,t,i,o,l,d,p,n,r,u,c,f,h,w,_,e=this;function g(o){if(h=(new Date).getTime(),!0!==u){if(!0===r)return f=o,void flashBag.show(window.textUpload.label_1);var e=o*l,n=e+l,t=new FileReader,s=d.slice(e,n);-1!==navigator.userAgent.toLowerCase().indexOf("msie")?t.readAsArrayBuffer(s):t.readAsBinaryString(s),t.onloadend=function(){var t=new XMLHttpRequest;t.open("post",a+"?action=start&tmp="+p,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState){var e=JSON.parse(t.response);if(void 0===e.response.upload.processFile||200!==t.status)return;if(0===e.response.upload.processFile.status)0!==o&&0!==p||(p=e.response.upload.processFile.tmp),o<c?(n=o+1,materialDesign.linearProgress(i,n,c),n%5==0&&(w+=(new Date).getTime()-h,_=Math.ceil(w/n*(c-n)/100),flashBag.show(_+window.textUpload.label_3)),g(o+1)):x();else{if(1===e.response.upload.processFile.status)return v("hide"),void(void 0!==e.response.upload.processFile.text&&flashBag.show(e.response.upload.processFile.text));2===e.response.upload.processFile.status&&x()}}var n},t.send(s)}}}function x(){var n=new XMLHttpRequest;n.open("post",a+"?action=finish&tmp="+p+"&name="+d.name,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4===n.readyState){var e=JSON.parse(n.response);if(void 0===e.response.upload.processFile||200!==n.status)return;$(t).find(".update_loading").css("display","none"),v("hide"),void 0!==e.response.upload.processFile.text&&flashBag.show(e.response.upload.processFile.text),""!==o&&utility.imageRefresh(o,1)}},n.send("")}function v(e){materialDesign.linearProgress(i),$(t).find(".upload_chunk .button_start i").text("play_arrow"),$(t).find(".upload_chunk .button_start span").text(window.textUpload.label_4),"show"===e?($(t).find(".upload_chunk .mdc-linear-progress").show(),$(t).find(".upload_chunk .controls").css("display","inline-block")):"hide"===e&&($(t).find(".upload_chunk .file").val(""),$(t).find(".upload_chunk .mdc-linear-progress").hide(),$(t).find(".upload_chunk .controls").css("display","none"),$(t).find(".material_upload button").parent().find("label").text(""),d=null),u=r=n=!1,_=w=h=f=c=p=0}e.setUrlRequest=function(e){a=e},e.setTagContainer=function(e){t=e},e.setTagProgressBar=function(e){i=e},e.setTagImageRefresh=function(e){o=e},e.init=function(){d=null,u=r=n=!1,_=w=h=f=c=p=l=0,i=o=t=a=""},e.processFile=function(){$(t).find(".upload_chunk .file").on("change","",function(){d=$(this)[0].files[0];var e=new FormData;e.append("file",d),ajax.send(!0,a+"?action=change","post",e,"json",!1,!1,!1,null,function(e){if(ajax.reply(e,""),void 0!==e.response.upload){if(l=e.response.upload.processFile,1===e.response.upload.processFile.status)return v("hide"),void(void 0!==e.response.upload.processFile.text&&flashBag.show(e.response.upload.processFile.text));null!==d?(v("show"),$(t).find(".upload_chunk .button_start").off("click").on("click","",function(){!1===n&&!1===r?null!==d&&(n=!0,$(t).find(".update_loading").css("display","inline-block"),flashBag.show(window.textUpload.label_2),$(t).find(".upload_chunk .button_start span").text(window.textUpload.label_5),c=Math.ceil(d.size/l),g(0)):!0===n&&!1===r?(r=!0,$(t).find(".update_loading").css("display","none"),$(t).find(".upload_chunk .button_start i").text("pause"),$(t).find(".upload_chunk .button_start span").text(window.textUpload.label_6)):!0===n&&!0===r&&(r=!1,$(t).find(".update_loading").css("display","inline-block"),$(t).find(".upload_chunk .button_start i").text("play_arrow"),$(t).find(".upload_chunk .button_start span").text(window.textUpload.label_5),g(f))}),$(t).find(".upload_chunk .button_stop").off("click").on("click","",function(){!function(){u=!0,loader.show();var n=new XMLHttpRequest;n.open("post",a+"?action=abort&tmp="+p,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4===n.readyState){var e=JSON.parse(n.response);if(void 0===e.response.upload.processFile||200!==n.status)return;$(t).find(".update_loading").css("display","none"),v("hide"),void 0!==e.response.upload.processFile.text&&flashBag.show(e.response.upload.processFile.text),loader.hide()}},n.send("")}()})):v("hide")}},null,null)})}}