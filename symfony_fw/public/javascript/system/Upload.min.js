var upload=new Upload;function Upload(){var s,t,i,n,l,r,p,o,d,u,f,c,w,h,g,e=this;function x(o){if(w=(new Date).getTime(),!0!==u){if(!0===d)return c=o,void flashBag.show(window.textUpload.label_1);var e=o*l,t=e+l,n=new FileReader,a=r.slice(e,t);-1!==navigator.userAgent.toLowerCase().indexOf("msie")?n.readAsArrayBuffer(a):n.readAsBinaryString(a),n.onloadend=function(){var n=new XMLHttpRequest;n.open("post",s+"?action=start&tmp="+p,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(4===n.readyState){var e=JSON.parse(n.response);if(200!==n.status)return;if(0===e.response.upload.processFile.status)0!==o&&0!==p||(p=e.response.upload.processFile.tmp),o<f?(t=o+1,materialDesign.linearProgress(i,t,f),t%5==0&&(h+=(new Date).getTime()-w,g=Math.ceil(h/t*(f-t)/100),flashBag.show(g+window.textUpload.label_3)),x(o+1)):m();else{if(1===e.response.upload.processFile.status)return _("hide"),void flashBag.show(e.response.upload.processFile.text);2===e.response.upload.processFile.status&&m()}}var t},n.send(a)}}}function m(){var t=new XMLHttpRequest;t.open("post",s+"?action=finish&tmp="+p+"&name="+r.name,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState){var e=JSON.parse(t.response);if(200!==t.status)return;_("hide"),null!==e.response.upload.processFile&&flashBag.show(e.response.upload.processFile.text),""!==n&&utility.imageRefresh(n,1)}},t.send("")}function _(e){materialDesign.linearProgress(i),$(t).find(".upload .button_start i").text("play_arrow"),$(t).find(".upload .button_start span").text(window.textUpload.label_4),"show"===e?($(t).find(".upload .mdc-linear-progress").show(),$(t).find(".upload .controls").show()):"hide"===e&&($(t).find(".upload .file").val(""),$(t).find(".upload .mdc-linear-progress").hide(),$(t).find(".upload .controls").hide(),r=null),u=d=o=!1,g=h=w=c=f=p=0}e.setUrlRequest=function(e){s=e},e.setTagContainer=function(e){t=e},e.setTagProgressBar=function(e){i=e},e.setTagImageRefresh=function(e){n=e},e.init=function(){r=null,u=d=o=!1,g=h=w=c=f=p=l=0,i=n=t=s=""},e.processFile=function(){$(t).find(".upload .file").on("change","",function(){r=$(this)[0].files[0];var e=new FormData;e.append("file",r),ajax.send(!0,s+"?action=change","post",e,"json",!1,!1,!1,null,function(e){if(ajax.reply(e,""),void 0!==e.response.upload){if(l=e.response.upload.processFile,1===e.response.upload.processFile.status)return _("hide"),void flashBag.show(e.response.upload.processFile.text);null!==r?(_("show"),$(t).find(".upload .button_start").off("click").on("click","",function(){!1===o&&!1===d?null!==r&&(o=!0,flashBag.show(window.textUpload.label_2),$(t).find(".upload .button_start span").text(window.textUpload.label_5),f=Math.ceil(r.size/l),x(0)):!0===o&&!1===d?(d=!0,$(t).find(".upload .button_start i").text("pause"),$(t).find(".upload .button_start span").text(window.textUpload.label_6)):!0===o&&!0===d&&(d=!1,$(t).find(".upload .button_start i").text("play_arrow"),$(t).find(".upload .button_start span").text(window.textUpload.label_5),x(c))}),$(t).find(".upload .button_stop").off("click").on("click","",function(){!function(){u=!0;var t=new XMLHttpRequest;t.open("post",s+"?action=abort&tmp="+p,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState){var e=JSON.parse(t.response);if(200!==t.status)return;_("hide"),null!==e.response.upload.processFile&&flashBag.show(e.response.upload.processFile.text)}},t.send("")}()})):_("hide")}},null,null)})}}