var wysiwyg=new Wysiwyg;function Wysiwyg(){var i,d,n,a,c,t,o,e=this;function s(e){if("load"===e)0<$(d).length&&($(d).html($(i).val()),$(".wysiwyg").find(".source").text($(i).val()),n=$(i).val(),a.push(n),c=0);else if("source"===e){if(0<$(d).length){var t=$.trim($(d).html());$(i).val(t),$(".wysiwyg").find(".source").text(t)}}else if("editor"===e){var l=$(".wysiwyg").find(".source");0<l.length&&$(d).html(l.text())}var n}function r(t,e){"undo"===t?p():"redo"===t?u():"foreColor"===t||"backColor"===t||"unlink"===t||"formatBlock"===t||"fontSize"===t?n.execCommand(t,!1,e):"createLink"===t?popupEasy.create(window.textWysiwyg.label_5,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_6+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$(".wysiwyg_popup").find(".mdc-text-field__input").val();n.execCommand(t,!1,e)}):"insertImage"===t?popupEasy.create(window.textWysiwyg.label_7,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_8+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$(".wysiwyg_popup").find(".mdc-text-field__input").val();n.execCommand(t,!1,e)}):"custom_button_add"===t?popupEasy.create(window.textWysiwyg.label_9,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){var e=$(".wysiwyg_popup").find(".mdc-text-field__input.label").val(),t=$(".wysiwyg_popup").find(".mdc-text-field__input.link").val();m(""===t?'<br><button class="mdc-button mdc-button--dense mdc-button--raised" type="button" contenteditable="false" style="display: block;">'+e+"</button><br>":'<br><a class="mdc-button mdc-button--dense mdc-button--raised" href="'+t+'" type="button" contenteditable="false">'+e+"</a><br>"),f()}):"custom_table_add"===t?popupEasy.create(window.textWysiwyg.label_12,'<div id="wysiwyg_popup">\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input row_number" type="text" value="1" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_13+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input column_number" type="text" value="4" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_14+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                </div>',function(){for(var e=$(".wysiwyg_popup").find(".mdc-text-field__input.row_number").val(),t=$(".wysiwyg_popup").find(".mdc-text-field__input.column_number").val(),l='<br><div class="mdc-layout-grid" contenteditable="false">',n=0;n<e;n++){l+='<div class="mdc-layout-grid__inner" contenteditable="false">';for(var i=0;i<t;i++)l+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';l+="</div>"}m(l+="</div><br>"),f()}):n.execCommand(t,!1,null)}function p(){if(0<=c){var e=a[--c];c<0&&(e=a[c=0]),$(d).html(e),o=!0}}function u(){if(c<a.length-1){var e=a[++c];$(d).html(e),o=!0}}function f(){var e=$(d).html();e!==a[c]&&(c<a.length-1&&a.splice(c+1),a.push(e),t<++c&&a.shift())}function y(){var e=window.frames[0].document,t=null;return e.getSelection?t=e.getSelection().anchorNode:e.selection&&(t=e.selection.anchorNode),null!==t&&(t=3===t.nodeType?t.parentNode:t),t}function m(e){var t=window.frames[0].document,l=null;if(t.getSelection){if(selection=t.getSelection(),selection.getRangeAt&&selection.rangeCount){var n=window.frames[0].document.createElement("div");n.innerHTML=e;for(var i=window.frames[0].document.createDocumentFragment(),d=null;node=n.firstChild;)d=i.appendChild(node);(l=selection.getRangeAt(0)).deleteContents(),l.insertNode(i),d&&((l=l.cloneRange()).setStartAfter(d),l.collapse(!0),selection.removeAllRanges(),selection.addRange(l))}}else t.selection&&(selection=t.selection,"Control"!==selection.type&&(l=selection.createRange()).pasteHTML(e))}e.init=function(){i="",n=d=null,a=new Array,c=-1,o=!(t=300)},e.create=function(t,l){setTimeout(function(){var e;i=t,$(i).parent().css("margin","0"),$(i).parent().hide(),$(l).click(function(){s("source")}),0<$(".wysiwyg").length&&($(".wysiwyg").find(".editor").contents().find("head").append("<style>\n                    html {\n                        padding: 5px !important;\n                        height: auto !important;\n                    }\n                    body .mdc-layout-grid {\n                        padding: 0;\n                    }\n                    body .mdc-layout-grid .mdc-layout-grid__cell {\n                        border: 1px solid #000000;\n                    }\n                </style>"),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto+Mono.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/Roboto_300_400_500.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-icons.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/library/material-components-web.min.css",type:"text/css"})),$($(".wysiwyg").find(".editor").contents().find("head")[0]).append($("<link/>",{rel:"stylesheet",href:window.url.root+"/css/system/"+window.setting.template+".css",type:"text/css"})),d=$(".wysiwyg").find(".editor").contents().find("body")[0],n=$(".wysiwyg").find(".editor").contents()[0],$(d).addClass("mdc-typography"),$(d).prop("contenteditable","true"),$(d).off("click").on("click","a",function(e){e.preventDefault()}),s("load"),$(".wysiwyg").find(".toolbar .mdc-fab").off("click").on("click","",function(e){e.preventDefault();var t=!0===$(e.target).parent().hasClass("mdc-fab")?$(e.target).parent():$(e.target),l=t.find("span").data("command");"source"===l?"none"===$(".wysiwyg").find(".source").css("display")==1?(s("source"),$(".wysiwyg").find(".editor").hide(),$(".wysiwyg").find(".source").show()):(s("editor"),$(".wysiwyg").find(".source").hide(),$(".wysiwyg").find(".editor").show()):"foreColor"===l||"backColor"===l?r(l,t.next().val()):r(l)}),$(".wysiwyg").find(".mdc-select .mdc-select__native-control").off("change").on("change","",function(e){e.preventDefault();var t=$(e.target).data("command");"formatBlock"!==t&&"fontSize"!==t||r(t,$(e.target).val())}),e=$(".wysiwyg").find(".editor").contents().find("body")[0],utility.mutationObserver(["characterData","childList"],e,function(){!1===o&&f()}),$(d).on("click","",function(e){o=!1;var t=y();0<$(t).parents(".mdc-layout-grid__cell").length&&(t=$(t).parents(".mdc-layout-grid__cell")[0]),(!1===$(t).hasClass("mdc-layout-grid__cell")||!0===$(t).hasClass("mdc-layout-grid__cell")&&"false"===$(t).prop("contenteditable"))&&$(d).find(".mdc-layout-grid__cell").prop("contenteditable",!1)}),$(d).on("dblclick","",function(e){var t=y();0<$(t).parents(".mdc-layout-grid__cell").length&&(t=$(t).parents(".mdc-layout-grid__cell")[0]),!0===$(t).hasClass("mdc-layout-grid__cell")&&($(d).find(".mdc-layout-grid__cell").prop("contenteditable",!1),$(t).prop("contenteditable",!0),$(t).focus())}),$(d).on("keydown","",function(e){return 13===e.keyCode&&n.execCommand("defaultParagraphSeparator",!1,"br"),!e.ctrlKey&&!0!==e.metaKey||90!==e.keyCode?!e.ctrlKey&&!0!==e.metaKey||89!==e.keyCode?void 0:(u(),!1):(p(),!1)}),$(d).on("keyup","",function(e){var t=$(n).find(".mdc-button");0<t.length&&(0===t.prev("br").length&&t.before("<br>"),0===t.next("br").length&&t.after("<br>"));var l=$(n).find(".mdc-layout-grid");0<l.length&&(0===l.prev("br").length&&l.before("<br>"),0===l.next("br").length&&l.after("<br>"))}),$(d).contextmenu(function(e){var l,n,t,i="",d=null,a="";if(!0===$(e.target).hasClass("mdc-button")){if(i="button",d=$(e.target),!0===$(e.target).is("button")){var c=$(e.target).text();a='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+c+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>'}else if(!0===$(e.target).is("a")){var c=$(e.target).text(),o=void 0===$(e.target).prop("href")?"":$(e.target).prop("href");a='<div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input label" type="text" value="'+c+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_10+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>\n                    <div class="mdc-text-field mdc-text-field__basic mdc-text-field--dense" style="width: 100%;">\n                        <input class="mdc-text-field__input link" type="text" value="'+o+'" autocomplete="off" aria-label="label"/>\n                        <label class="mdc-floating-label">'+window.textWysiwyg.label_11+'</label>\n                        <div class="mdc-line-ripple"></div>\n                    </div>\n                    <p class="mdc-text-field-helper-text" aria-hidden="true"></p>'}}else(!0===$(e.target).hasClass("mdc-layout-grid__cell")||0<$(e.target).parents(".mdc-layout-grid__cell").length)&&(d=$(e.target),0<$(e.target).parents(".mdc-layout-grid__cell").length&&(d=$(e.target).parents(".mdc-layout-grid__cell")),i="table",a="<fieldset>\n                    <legend>"+window.textWysiwyg.label_16+'</legend>\n                    <button id="row_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_17+'</button>\n                    <button id="row_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_18+"</button>\n                </fieldset>\n                <fieldset>\n                    <legend>"+window.textWysiwyg.label_19+'</legend>\n                    <button id="column_add" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_20+'</button>\n                    <button id="column_remove" class="mdc-button mdc-button--dense mdc-button--raised" type="button">'+window.textWysiwyg.label_21+"</button>\n                </fieldset>");return""!==a&&(l=i,n=d,t=a,popupEasy.create(window.textWysiwyg.label_15,'<div id="wysiwyg_popup">'+t+"</div>",function(){if("button"===l){var e=$(".wysiwyg_popup").find(".mdc-text-field__input.label").val(),t=$(".wysiwyg_popup").find(".mdc-text-field__input.link").val();n.text(e),n.prop("href",t)}}),"table"===l&&($("#row_add").off("click").on("click","",function(){for(var e=n.parent().find(".mdc-layout-grid__cell").length,t='<div class="mdc-layout-grid__inner" contenteditable="false">',l=0;l<e;l++)t+='<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>';t+="</div>",n.parent().after(t),popupEasy.close()}),$("#row_remove").off("click").on("click","",function(){n.parent().remove(),popupEasy.close()}),$("#column_add").off("click").on("click","",function(){var l=n.index();$.each(n.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(e,t){$(t).find(".mdc-layout-grid__cell").eq(l).after('<div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-2" contenteditable="false">&nbsp;</div>')}),popupEasy.close()}),$("#column_remove").off("click").on("click","",function(){var l=n.index();$.each(n.parents(".mdc-layout-grid").find(".mdc-layout-grid__inner"),function(e,t){$(t).find(".mdc-layout-grid__cell").eq(l).remove()}),popupEasy.close()}))),!1}))},100)},e.historyClear=function(){a=new Array},e.save=function(){s("source")}}